---
// 页面元数据
const pageTitle = "JSON Formatter - RuanTools";
const description = "一个美观易用的 JSON 格式化工具，支持语法高亮、错误检测和一键复制。";
---

<html lang="zh-CN" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <title>{pageTitle}</title>
    <style>
      /* 简单的 JSON 语法高亮 CSS */
      .json-highlight {
        background: #1a1a1a;
        color: #f8f8f2;
        padding: 1rem;
        border-radius: 0.5rem;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 0.9rem;
        line-height: 1.5;
        overflow-x: auto;
      }
      .json-key { color: #f92672; }
      .json-string { color: #a6e22e; }
      .json-number { color: #ae81ff; }
      .json-boolean { color: #fd971f; }
      .json-null { color: #f92672; }
      .json-error { color: #ff5555; background: rgba(255,85,85,0.1); border-left: 4px solid #ff5555; }
    </style>
  </head>
  <body class="h-full bg-gray-50 text-gray-900 flex flex-col">
    <!-- 头部导航 -->
    <header class="bg-white shadow-sm border-b">
      <div class="max-w-4xl mx-auto px-4 py-4">
        <h1 class="text-2xl font-bold text-gray-800">JSON 格式化工具</h1>
        <p class="text-sm text-gray-600 mt-1">粘贴或输入 JSON 数据，自动格式化并高亮显示</p>
      </div>
    </header>

    <!-- 主内容区 -->
    <main class="flex-1 max-w-4xl w-full mx-auto px-4 py-6">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 h-full">
        <!-- 输入区域 -->
        <div class="flex flex-col">
          <label for="input" class="text-sm font-medium text-gray-700 mb-2">输入 JSON</label>
          <textarea
            id="input"
            placeholder='例如：{"name": "张三", "age": 25, "hobbies": ["阅读", "编程"]}'
            class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-mono text-sm resize-none"
            spellcheck="false"
          ></textarea>
        </div>

        <!-- 输出区域 -->
        <div class="flex flex-col">
          <div class="flex justify-between items-center mb-2">
            <label class="text-sm font-medium text-gray-700">格式化结果</label>
            <div class="flex space-x-2">
              <button id="copyBtn" class="px-3 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600 transition-colors">复制</button>
            </div>
          </div>
          <pre id="output" class="json-highlight flex-1">等待输入...</pre>
        </div>
      </div>
    </main>

    <!-- 底部信息 -->
    <footer class="bg-white border-t py-4 text-center text-sm text-gray-500">
      <p>&copy; 2024 RuanTools - 在线工具集合</p>
    </footer>

    <script>
      const inputEl = document.getElementById('input');
      const outputEl = document.getElementById('output');
      const copyBtn = document.getElementById('copyBtn');

      // 简单的 JSON 语法高亮函数
      function highlightJson(jsonStr) {
        try {
          const obj = JSON.parse(jsonStr);
          const formatted = JSON.stringify(obj, null, 2);
          
          // 简单的关键字替换高亮
          return formatted
            .replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?)/g, (match) => {
              if (match.endsWith(':')) {
                return `<span class="json-key">${match}</span>`;
              } else {
                return `<span class="json-string">${match}</span>`;
              }
            })
            .replace(/\b(true|false|null)\b/g, '<span class="json-boolean">$1</span>')
            .replace(/\b\d+\b/g, '<span class="json-number">$&</span>');
        } catch (e) {
          return `<span class="json-error">❌ 错误: ${e.message}</span>`;
        }
      }

      // 实时格式化
      inputEl.addEventListener('input', () => {
        const value = inputEl.value.trim();
        if (value) {
          outputEl.innerHTML = highlightJson(value);
        } else {
          outputEl.textContent = '等待输入...';
        }
      });

      // 复制功能
      copyBtn.addEventListener('click', async () => {
        try {
          const text = outputEl.textContent;
          if (text && text !== '等待输入...' && !text.includes('❌ 错误')) {
            await navigator.clipboard.writeText(text);
            copyBtn.textContent = '已复制!';
            setTimeout(() => { copyBtn.textContent = '复制'; }, 1500);
          }
        } catch (e) {
          console.error('复制失败:', e);
        }
      });
    </script>
  </body>
</html>
