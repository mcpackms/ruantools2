---
// é¡µé¢å…ƒæ•°æ®
const pageTitle = "æ­£åˆ™è¡¨è¾¾å¼æµ‹è¯•å·¥å…· - RuanTools";
const description = "åœ¨çº¿æµ‹è¯•ã€è°ƒè¯•å’ŒéªŒè¯æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ”¯æŒå¤šç§åŒ¹é…æ¨¡å¼å’Œå®æ—¶é«˜äº®";
---

<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <title>{pageTitle}</title>
    
    <!-- ä»£ç é«˜äº®æ ·å¼ -->
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        line-height: 1.6;
        color: #333;
        background: #f8f9fa;
        min-height: 100vh;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      /* å¤´éƒ¨æ ·å¼ */
      .header {
        margin-bottom: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2rem;
        font-weight: 600;
        margin-bottom: 8px;
        color: #1a1a1a;
      }

      .header p {
        color: #666;
        font-size: 0.95rem;
        max-width: 600px;
        margin: 0 auto;
      }

      /* å¡ç‰‡æ ·å¼ */
      .card {
        background: white;
        border-radius: 10px;
        padding: 25px;
        margin-bottom: 20px;
        border: 1px solid #e0e0e0;
      }

      .section-title {
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 20px;
        color: #2c3e50;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .section-title::before {
        content: "ğŸ”";
        font-size: 1.1rem;
      }

      /* è¾“å…¥åŒºåŸŸ */
      .input-group {
        margin-bottom: 20px;
      }

      .input-label {
        display: block;
        margin-bottom: 8px;
        font-size: 0.9rem;
        color: #555;
        font-weight: 500;
      }

      .input-field {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
        font-size: 0.9rem;
        background: #fafafa;
        transition: border-color 0.2s;
      }

      .input-field:focus {
        outline: none;
        border-color: #007bff;
        background: white;
      }

      .input-field::placeholder {
        color: #999;
      }

      /* æ–‡æœ¬åŒºåŸŸ */
      .textarea-field {
        width: 100%;
        min-height: 150px;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
        font-size: 0.9rem;
        resize: vertical;
        background: #fafafa;
        line-height: 1.5;
        white-space: pre;
        overflow-x: auto;
        transition: border-color 0.2s;
      }

      .textarea-field:focus {
        outline: none;
        border-color: #007bff;
        background: white;
      }

      /* æ¨¡å¼é€‰æ‹©å™¨ */
      .mode-selector {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 20px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 6px;
      }

      .mode-item {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 0.85rem;
      }

      .mode-checkbox {
        width: 16px;
        height: 16px;
        cursor: pointer;
      }

      .mode-label {
        color: #555;
        cursor: pointer;
        font-size: 0.85rem;
      }

      /* æŒ‰é’®ç»„ */
      .button-group {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 15px;
      }

      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        font-size: 0.9rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }

      .btn-primary {
        background: #007bff;
        color: white;
      }

      .btn-primary:hover {
        background: #0056b3;
      }

      .btn-outline {
        background: white;
        color: #555;
        border: 1px solid #ddd;
      }

      .btn-outline:hover {
        background: #f8f9fa;
        border-color: #bbb;
      }

      /* ç»“æœå±•ç¤º */
      .results {
        margin-top: 25px;
        display: none;
      }

      .result-title {
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 15px;
        color: #2c3e50;
      }

      .result-item {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 15px;
        border: 1px solid #e0e0e0;
      }

      .result-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
        padding-bottom: 10px;
        border-bottom: 1px solid #e9ecef;
      }

      .result-name {
        font-size: 1rem;
        font-weight: 600;
        color: #2c3e50;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .result-value {
        font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
        font-size: 0.85rem;
        color: #333;
        word-break: break-all;
        line-height: 1.4;
      }

      .result-value.highlighted {
        padding: 10px;
        background: #f8f9fa;
        border-radius: 4px;
        border-left: 3px solid #007bff;
      }

      /* åŒ¹é…ç»“æœå±•ç¤º */
      .matches-container {
        max-height: 300px;
        overflow-y: auto;
        border: 1px solid #e0e0e0;
        border-radius: 6px;
        margin-top: 10px;
      }

      .match-item {
        padding: 10px 15px;
        border-bottom: 1px solid #e9ecef;
        font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
        font-size: 0.85rem;
      }

      .match-item:last-child {
        border-bottom: none;
      }

      .match-item:nth-child(odd) {
        background: #f8f9fa;
      }

      .match-item:nth-child(even) {
        background: white;
      }

      .match-highlight {
        background: #fff3cd;
        padding: 0 2px;
        border-radius: 2px;
        border: 1px solid #ffc107;
      }

      .match-index {
        font-size: 0.75rem;
        color: #666;
        margin-right: 10px;
      }

      .match-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 5px;
        font-size: 0.8rem;
        color: #666;
      }

      /* åŠ è½½æŒ‡ç¤ºå™¨ */
      .loading {
        display: none;
        align-items: center;
        gap: 10px;
        margin: 15px 0;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 6px;
        color: #666;
      }

      .loading-spinner {
        width: 20px;
        height: 20px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #007bff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      /* å¿«é€Ÿç¤ºä¾‹ */
      .quick-examples {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 10px;
        margin-top: 15px;
      }

      .example-btn {
        padding: 8px 12px;
        background: #e9ecef;
        border: 1px solid #ddd;
        border-radius: 4px;
        color: #555;
        font-size: 0.85rem;
        cursor: pointer;
        text-align: left;
        transition: all 0.2s;
      }

      .example-btn:hover {
        background: #dee2e6;
        border-color: #adb5bd;
      }

      /* é¡µè„š */
      .footer {
        text-align: center;
        margin-top: 40px;
        padding-top: 20px;
        border-top: 1px solid #e0e0e0;
        color: #666;
        font-size: 0.9rem;
      }

      /* å“åº”å¼è®¾è®¡ */
      @media (max-width: 768px) {
        .container {
          padding: 15px;
        }

        .button-group {
          flex-direction: column;
        }

        .btn {
          width: 100%;
          justify-content: center;
        }

        .quick-examples {
          grid-template-columns: 1fr;
        }
      }

      /* é«˜äº®æ ·å¼ */
      .highlight-container {
        position: relative;
        min-height: 150px;
        border: 1px solid #ddd;
        border-radius: 6px;
        overflow: hidden;
      }

      .highlight-textarea {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        padding: 12px 15px;
        border: none;
        background: transparent;
        color: transparent;
        caret-color: #333;
        font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
        font-size: 0.9rem;
        line-height: 1.5;
        resize: none;
        overflow: auto;
        white-space: pre;
        z-index: 1;
      }

      .highlight-output {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        padding: 12px 15px;
        overflow: auto;
        font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
        font-size: 0.9rem;
        line-height: 1.5;
        white-space: pre;
        z-index: 0;
      }

      .highlight-match {
        background: #fff3cd;
        padding: 0 2px;
        border-radius: 2px;
        border: 1px solid #ffc107;
      }

      .highlight-group-0 { background: #d4edda; border-color: #c3e6cb; }
      .highlight-group-1 { background: #cce5ff; border-color: #b8daff; }
      .highlight-group-2 { background: #e2e3e5; border-color: #d6d8db; }
      .highlight-group-3 { background: #f8d7da; border-color: #f5c6cb; }
      .highlight-group-4 { background: #d1ecf1; border-color: #bee5eb; }
      .highlight-group-5 { background: #fff3cd; border-color: #ffeaa7; }
      .highlight-group-6 { background: #d6d8d9; border-color: #c6c8ca; }
      .highlight-group-7 { background: #d7e4f5; border-color: #c7d9f1; }
      .highlight-group-8 { background: #e9e9e9; border-color: #d9d9d9; }
      .highlight-group-9 { background: #e8e4f5; border-color: #d8d4f1; }

      /* æ›¿æ¢ç»“æœ */
      .replace-result {
        background: #e7f5ff;
        border-left: 3px solid #007bff;
        padding: 15px;
        border-radius: 4px;
        font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
        white-space: pre-wrap;
        word-break: break-all;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- å¤´éƒ¨ -->
      <header class="header">
        <h1>æ­£åˆ™è¡¨è¾¾å¼æµ‹è¯•å·¥å…·</h1>
        <p>åœ¨çº¿æµ‹è¯•ã€è°ƒè¯•å’ŒéªŒè¯æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ”¯æŒå¤šç§åŒ¹é…æ¨¡å¼å’Œå®æ—¶é«˜äº®</p>
      </header>

      <!-- ä¸»å†…å®¹åŒºåŸŸ -->
      <div class="card">
        <h2 class="section-title">æ­£åˆ™è¡¨è¾¾å¼æµ‹è¯•</h2>
        
        <!-- æ­£åˆ™è¡¨è¾¾å¼è¾“å…¥ -->
        <div class="input-group">
          <label for="regex-input" class="input-label">æ­£åˆ™è¡¨è¾¾å¼</label>
          <input 
            type="text" 
            id="regex-input" 
            class="input-field" 
            placeholder="è¾“å…¥æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¾‹å¦‚ï¼š\d{3}-\d{3}-\d{4}"
            value="\w+@\w+\.\w+"
          />
        </div>

        <!-- æµ‹è¯•æ–‡æœ¬è¾“å…¥ -->
        <div class="input-group">
          <label for="test-text" class="input-label">æµ‹è¯•æ–‡æœ¬</label>
          <div class="highlight-container">
            <textarea 
              id="test-text" 
              class="highlight-textarea" 
              placeholder="è¾“å…¥è¦æµ‹è¯•çš„æ–‡æœ¬..."
              rows="8"
            >è¯·å‘é€é‚®ä»¶åˆ° test@example.com æˆ–è”ç³» admin@domain.com è·å–æ›´å¤šä¿¡æ¯ã€‚</textarea>
            <div id="highlight-output" class="highlight-output"></div>
          </div>
        </div>

        <!-- æ›¿æ¢æ–‡æœ¬è¾“å…¥ -->
        <div class="input-group">
          <label for="replace-text" class="input-label">æ›¿æ¢æ–‡æœ¬ï¼ˆå¯é€‰ï¼‰</label>
          <input 
            type="text" 
            id="replace-text" 
            class="input-field" 
            placeholder="è¾“å…¥æ›¿æ¢æ–‡æœ¬ï¼Œä¾‹å¦‚ï¼š[é‚®ç®±]"
          />
        </div>

        <!-- æ¨¡å¼é€‰æ‹© -->
        <div class="mode-selector">
          <div class="mode-item">
            <input type="checkbox" id="mode-g" class="mode-checkbox" checked />
            <label for="mode-g" class="mode-label" title="å…¨å±€åŒ¹é…">å…¨å±€åŒ¹é… (g)</label>
          </div>
          <div class="mode-item">
            <input type="checkbox" id="mode-i" class="mode-checkbox" />
            <label for="mode-i" class="mode-label" title="å¿½ç•¥å¤§å°å†™">å¿½ç•¥å¤§å°å†™ (i)</label>
          </div>
          <div class="mode-item">
            <input type="checkbox" id="mode-m" class="mode-checkbox" />
            <label for="mode-m" class="mode-label" title="å¤šè¡Œæ¨¡å¼">å¤šè¡Œæ¨¡å¼ (m)</label>
          </div>
          <div class="mode-item">
            <input type="checkbox" id="mode-s" class="mode-checkbox" />
            <label for="mode-s" class="mode-label" title="ç‚¹å·åŒ¹é…æ‰€æœ‰å­—ç¬¦">ç‚¹å·åŒ¹é…æ‰€æœ‰ (s)</label>
          </div>
          <div class="mode-item">
            <input type="checkbox" id="mode-u" class="mode-checkbox" />
            <label for="mode-u" class="mode-label" title="Unicodeæ¨¡å¼">Unicode (u)</label>
          </div>
        </div>

        <!-- å¿«é€Ÿç¤ºä¾‹ -->
        <div class="input-group">
          <label class="input-label">å¿«é€Ÿç¤ºä¾‹</label>
          <div class="quick-examples">
            <button class="example-btn" data-regex="\d+" data-text="æˆ‘çš„ç”µè¯å·ç æ˜¯ 123-456-7890">åŒ¹é…æ•°å­—ï¼š\d+</button>
            <button class="example-btn" data-regex="[A-Za-z]+" data-text="Hello World 123">åŒ¹é…å­—æ¯ï¼š[A-Za-z]+</button>
            <button class="example-btn" data-regex="\w+@\w+\.\w+" data-text="è”ç³»é‚®ç®±ï¼štest@example.com">åŒ¹é…é‚®ç®±ï¼š\w+@\w+\.\w+</button>
            <button class="example-btn" data-regex="https?://[^\s]+" data-text="è®¿é—® https://example.com">åŒ¹é…URLï¼šhttps?://[^\s]+</button>
            <button class="example-btn" data-regex="\d{4}-\d{2}-\d{2}" data-text="æ—¥æœŸï¼š2024-01-15">åŒ¹é…æ—¥æœŸï¼š\d{4}-\d{2}-\d{2}</button>
            <button class="example-btn" data-regex="\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\b" data-text="IPåœ°å€ï¼š192.168.1.1">åŒ¹é…IPï¼š\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\b</button>
          </div>
        </div>

        <!-- æŒ‰é’®ç»„ -->
        <div class="button-group">
          <button id="test-btn" class="btn btn-primary">æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼</button>
          <button id="replace-btn" class="btn btn-outline">æ‰§è¡Œæ›¿æ¢</button>
          <button id="clear-btn" class="btn btn-outline">æ¸…ç©ºæ‰€æœ‰</button>
        </div>

        <div id="loading" class="loading">
          <div class="loading-spinner"></div>
          <span>æ­£åœ¨å¤„ç†...</span>
        </div>

        <!-- é”™è¯¯ä¿¡æ¯ -->
        <div id="error-message" style="display: none; margin-top: 15px; padding: 10px; background: #f8d7da; color: #721c24; border-radius: 4px; border: 1px solid #f5c6cb;"></div>
      </div>

      <!-- ç»“æœæ˜¾ç¤º -->
      <div id="results-section" class="card" style="display: none;">
        <h3 class="result-title">æµ‹è¯•ç»“æœ</h3>
        <div id="results-container">
          <!-- ç»“æœå°†åœ¨è¿™é‡ŒåŠ¨æ€æ˜¾ç¤º -->
        </div>
      </div>

      <!-- ä½¿ç”¨è¯´æ˜ -->
      <div class="card">
        <h2 class="section-title">ä½¿ç”¨è¯´æ˜</h2>
        <div style="color: #666; line-height: 1.6; font-size: 0.9rem;">
          <p><strong>å¸¸ç”¨æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•ï¼š</strong></p>
          <ul style="padding-left: 20px; margin-top: 8px;">
            <li><code>\d</code> - åŒ¹é…æ•°å­—ï¼ˆ0-9ï¼‰</li>
            <li><code>\w</code> - åŒ¹é…å•è¯å­—ç¬¦ï¼ˆå­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ï¼‰</li>
            <li><code>\s</code> - åŒ¹é…ç©ºç™½å­—ç¬¦ï¼ˆç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ç­‰ï¼‰</li>
            <li><code>.</code> - åŒ¹é…ä»»æ„å­—ç¬¦ï¼ˆé™¤æ¢è¡Œç¬¦ï¼‰</li>
            <li><code>[abc]</code> - åŒ¹é…æ–¹æ‹¬å·ä¸­çš„ä»»æ„å­—ç¬¦</li>
            <li><code>[^abc]</code> - åŒ¹é…ä¸åœ¨æ–¹æ‹¬å·ä¸­çš„ä»»æ„å­—ç¬¦</li>
            <li><code>*</code> - åŒ¹é…0æ¬¡æˆ–å¤šæ¬¡</li>
            <li><code>+</code> - åŒ¹é…1æ¬¡æˆ–å¤šæ¬¡</li>
            <li><code>?</code> - åŒ¹é…0æ¬¡æˆ–1æ¬¡</li>
            <li><code>{n}</code> - åŒ¹é…æ°å¥½næ¬¡</li>
            <li><code>{n,}</code> - åŒ¹é…è‡³å°‘næ¬¡</li>
            <li><code>{n,m}</code> - åŒ¹é…nåˆ°mæ¬¡</li>
            <li><code>^</code> - åŒ¹é…å­—ç¬¦ä¸²å¼€å¤´ï¼ˆå¤šè¡Œæ¨¡å¼ä¸‹åŒ¹é…è¡Œé¦–ï¼‰</li>
            <li><code>$</code> - åŒ¹é…å­—ç¬¦ä¸²ç»“å°¾ï¼ˆå¤šè¡Œæ¨¡å¼ä¸‹åŒ¹é…è¡Œå°¾ï¼‰</li>
            <li><code>(...)</code> - æ•è·åˆ†ç»„</li>
            <li><code>(?:...)</code> - éæ•è·åˆ†ç»„</li>
            <li><code>\b</code> - å•è¯è¾¹ç•Œ</li>
            <li><code>|</code> - æˆ–æ“ä½œ</li>
          </ul>
          
          <p style="margin-top: 12px;"><strong>æ¨¡å¼è¯´æ˜ï¼š</strong></p>
          <ul style="padding-left: 20px; margin-top: 8px;">
            <li><strong>å…¨å±€åŒ¹é… (g)</strong> - æŸ¥æ‰¾æ‰€æœ‰åŒ¹é…ï¼Œè€Œä¸æ˜¯åœ¨ç¬¬ä¸€ä¸ªåŒ¹é…ååœæ­¢</li>
            <li><strong>å¿½ç•¥å¤§å°å†™ (i)</strong> - åŒ¹é…æ—¶å¿½ç•¥å­—æ¯å¤§å°å†™</li>
            <li><strong>å¤šè¡Œæ¨¡å¼ (m)</strong> - ä½¿ ^ å’Œ $ åŒ¹é…æ¯è¡Œçš„å¼€å¤´å’Œç»“å°¾</li>
            <li><strong>ç‚¹å·åŒ¹é…æ‰€æœ‰ (s)</strong> - ä½¿ . åŒ¹é…åŒ…æ‹¬æ¢è¡Œç¬¦åœ¨å†…çš„æ‰€æœ‰å­—ç¬¦</li>
            <li><strong>Unicodeæ¨¡å¼ (u)</strong> - æ­£ç¡®å¤„ç† Unicode å­—ç¬¦</li>
          </ul>
          
          <p style="margin-top: 12px;"><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p>
          <ul style="padding-left: 20px; margin-top: 8px;">
            <li>æ­£åˆ™è¡¨è¾¾å¼æµ‹è¯•å®Œå…¨åœ¨æµè§ˆå™¨æœ¬åœ°å®Œæˆï¼Œæ— éœ€ç½‘ç»œè¿æ¥</li>
            <li>ç‚¹å‡»"å¿«é€Ÿç¤ºä¾‹"æŒ‰é’®å¯ä»¥å¿«é€Ÿå¡«å……ç¤ºä¾‹</li>
            <li>æ”¯æŒå®æ—¶é«˜äº®æ˜¾ç¤ºåŒ¹é…ç»“æœ</li>
            <li>ç‚¹å‡»åŒ¹é…ç»“æœå¯ä»¥æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</li>
            <li>å¯ä»¥åœ¨æ›¿æ¢æ–‡æœ¬ä¸­ä½¿ç”¨ $1ã€$2 ç­‰å¼•ç”¨æ•è·ç»„</li>
          </ul>
        </div>
      </div>

      <!-- é¡µè„š -->
      <footer class="footer">
        <p>Â© 2024 RuanTools Â· æ­£åˆ™è¡¨è¾¾å¼æµ‹è¯•å·¥å…·</p>
        <p style="margin-top: 5px;">ä½¿ç”¨åŸç”ŸJavaScriptæ­£åˆ™è¡¨è¾¾å¼å¼•æ“ï¼Œå®Œå…¨ç¦»çº¿å·¥ä½œ</p>
      </footer>
    </div>

    <script>
      // DOMå…ƒç´ 
      const regexInput = document.getElementById('regex-input');
      const testText = document.getElementById('test-text');
      const replaceText = document.getElementById('replace-text');
      const highlightOutput = document.getElementById('highlight-output');
      const testBtn = document.getElementById('test-btn');
      const replaceBtn = document.getElementById('replace-btn');
      const clearBtn = document.getElementById('clear-btn');
      const resultsSection = document.getElementById('results-section');
      const resultsContainer = document.getElementById('results-container');
      const errorMessage = document.getElementById('error-message');
      const loading = document.getElementById('loading');
      const quickExampleBtns = document.querySelectorAll('.example-btn');

      // æ¨¡å¼å¤é€‰æ¡†
      const modeG = document.getElementById('mode-g');
      const modeI = document.getElementById('mode-i');
      const modeM = document.getElementById('mode-m');
      const modeS = document.getElementById('mode-s');
      const modeU = document.getElementById('mode-u');

      // è·å–é€‰ä¸­çš„æ¨¡å¼
      function getSelectedModes() {
        const modes = [];
        if (modeG.checked) modes.push('g');
        if (modeI.checked) modes.push('i');
        if (modeM.checked) modes.push('m');
        if (modeS.checked) modes.push('s');
        if (modeU.checked) modes.push('u');
        return modes.join('');
      }

      // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
      function showError(message) {
        errorMessage.textContent = message;
        errorMessage.style.display = 'block';
        resultsSection.style.display = 'none';
      }

      // éšè—é”™è¯¯ä¿¡æ¯
      function hideError() {
        errorMessage.style.display = 'none';
      }

      // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
      function showLoading() {
        loading.style.display = 'flex';
      }

      // éšè—åŠ è½½åŠ¨ç”»
      function hideLoading() {
        loading.style.display = 'none';
      }

      // é«˜äº®åŒ¹é…çš„æ–‡æœ¬
      function highlightMatches(text, regex) {
        if (!regex) return text;
        
        try {
          const flags = getSelectedModes();
          const pattern = new RegExp(regex, flags);
          
          // åˆ›å»ºé«˜äº®HTML
          let highlighted = '';
          let lastIndex = 0;
          
          if (flags.includes('g')) {
            const matches = [...text.matchAll(pattern)];
            
            matches.forEach((match, matchIndex) => {
              // æ·»åŠ åŒ¹é…å‰çš„æ–‡æœ¬
              highlighted += escapeHtml(text.substring(lastIndex, match.index));
              
              // æ·»åŠ åŒ¹é…æ–‡æœ¬
              const matchText = match[0];
              highlighted += `<span class="highlight-match">${escapeHtml(matchText)}</span>`;
              
              lastIndex = match.index + matchText.length;
            });
          } else {
            const match = pattern.exec(text);
            if (match) {
              highlighted += escapeHtml(text.substring(0, match.index));
              highlighted += `<span class="highlight-match">${escapeHtml(match[0])}</span>`;
              lastIndex = match.index + match[0].length;
            }
          }
          
          // æ·»åŠ å‰©ä½™æ–‡æœ¬
          highlighted += escapeHtml(text.substring(lastIndex));
          return highlighted;
        } catch (error) {
          return escapeHtml(text);
        }
      }

      // è½¬ä¹‰HTMLç‰¹æ®Šå­—ç¬¦
      function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      // æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼
      function testRegex() {
        hideError();
        showLoading();
        
        setTimeout(() => {
          try {
            const regexStr = regexInput.value.trim();
            const text = testText.value;
            
            if (!regexStr) {
              showError('è¯·è¾“å…¥æ­£åˆ™è¡¨è¾¾å¼');
              hideLoading();
              return;
            }
            
            if (!text) {
              showError('è¯·è¾“å…¥æµ‹è¯•æ–‡æœ¬');
              hideLoading();
              return;
            }
            
            const flags = getSelectedModes();
            const regex = new RegExp(regexStr, flags);
            
            // æ›´æ–°é«˜äº®æ˜¾ç¤º
            highlightOutput.innerHTML = highlightMatches(text, regexStr);
            
            // æ‰§è¡ŒåŒ¹é…
            let matches = [];
            if (flags.includes('g')) {
              matches = [...text.matchAll(regex)];
            } else {
              const match = regex.exec(text);
              if (match) {
                matches = [match];
              }
            }
            
            // æ˜¾ç¤ºç»“æœ
            displayResults(matches, text, regex);
            
            hideLoading();
          } catch (error) {
            hideLoading();
            showError(`æ­£åˆ™è¡¨è¾¾å¼é”™è¯¯: ${error.message}`);
            highlightOutput.innerHTML = escapeHtml(testText.value);
          }
        }, 50);
      }

      // æ‰§è¡Œæ›¿æ¢
      function replaceTextHandler() {
        hideError();
        showLoading();
        
        setTimeout(() => {
          try {
            const regexStr = regexInput.value.trim();
            const text = testText.value;
            const replaceStr = replaceText.value;
            
            if (!regexStr) {
              showError('è¯·è¾“å…¥æ­£åˆ™è¡¨è¾¾å¼');
              hideLoading();
              return;
            }
            
            if (!text) {
              showError('è¯·è¾“å…¥æµ‹è¯•æ–‡æœ¬');
              hideLoading();
              return;
            }
            
            const flags = getSelectedModes();
            const regex = new RegExp(regexStr, flags);
            
            // æ‰§è¡Œæ›¿æ¢
            const replacedText = text.replace(regex, replaceStr);
            
            // æ˜¾ç¤ºæ›¿æ¢ç»“æœ
            displayReplaceResult(text, replacedText, regex);
            
            hideLoading();
          } catch (error) {
            hideLoading();
            showError(`æ›¿æ¢é”™è¯¯: ${error.message}`);
          }
        }, 50);
      }

      // æ˜¾ç¤ºåŒ¹é…ç»“æœ
      function displayResults(matches, originalText, regex) {
        resultsContainer.innerHTML = '';
        
        if (matches.length === 0) {
          const noResult = document.createElement('div');
          noResult.className = 'result-item';
          noResult.innerHTML = `
            <div class="result-header">
              <div class="result-name">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…</div>
            </div>
            <div class="result-value">åœ¨è¾“å…¥æ–‡æœ¬ä¸­æ²¡æœ‰æ‰¾åˆ°åŒ¹é…é¡¹ã€‚</div>
          `;
          resultsContainer.appendChild(noResult);
        } else {
          // åŒ¹é…ç»Ÿè®¡
          const stats = document.createElement('div');
          stats.className = 'result-item';
          stats.innerHTML = `
            <div class="result-header">
              <div class="result-name">åŒ¹é…ç»Ÿè®¡</div>
            </div>
            <div class="result-value">
              æ‰¾åˆ° ${matches.length} ä¸ªåŒ¹é…é¡¹<br>
              æ­£åˆ™è¡¨è¾¾å¼: <code>${escapeHtml(regex.source)}</code><br>
              æ ‡å¿—: ${regex.flags || '(æ— )'}
            </div>
          `;
          resultsContainer.appendChild(stats);
          
          // åŒ¹é…è¯¦æƒ…
          const matchesContainer = document.createElement('div');
          matchesContainer.className = 'result-item';
          matchesContainer.innerHTML = `
            <div class="result-header">
              <div class="result-name">åŒ¹é…è¯¦æƒ…</div>
              <span style="font-size: 0.8rem; color: #666;">å…± ${matches.length} ä¸ªåŒ¹é…</span>
            </div>
            <div class="matches-container" id="matches-list"></div>
          `;
          resultsContainer.appendChild(matchesContainer);
          
          const matchesList = document.getElementById('matches-list');
          
          matches.forEach((match, index) => {
            const matchItem = document.createElement('div');
            matchItem.className = 'match-item';
            
            const matchInfo = document.createElement('div');
            matchInfo.className = 'match-info';
            matchInfo.innerHTML = `
              <span>åŒ¹é… #${index + 1}</span>
              <span>ä½ç½®: ${match.index} - ${match.index + match[0].length}</span>
            `;
            
            const matchText = document.createElement('div');
            matchText.innerHTML = `<span class="match-index">[${index}]</span> <span class="highlight-match">${escapeHtml(match[0])}</span>`;
            
            // å¦‚æœæœ‰åˆ†ç»„
            if (match.length > 1) {
              const groups = document.createElement('div');
              groups.style.marginTop = '8px';
              groups.style.fontSize = '0.8rem';
              groups.style.color = '#666';
              
              let groupsHtml = '<strong>æ•è·ç»„:</strong><br>';
              for (let i = 1; i < match.length; i++) {
                const groupClass = `highlight-group-${(i-1) % 10}`;
                groupsHtml += `  $${i}: <span class="${groupClass}" style="padding: 0 2px; border-radius: 2px;">${escapeHtml(match[i] || '(ç©º)')}</span><br>`;
              }
              groups.innerHTML = groupsHtml;
              
              matchItem.appendChild(matchInfo);
              matchItem.appendChild(matchText);
              matchItem.appendChild(groups);
            } else {
              matchItem.appendChild(matchInfo);
              matchItem.appendChild(matchText);
            }
            
            matchesList.appendChild(matchItem);
          });
        }
        
        resultsSection.style.display = 'block';
      }

      // æ˜¾ç¤ºæ›¿æ¢ç»“æœ
      function displayReplaceResult(originalText, replacedText, regex) {
        resultsContainer.innerHTML = '';
        
        const originalItem = document.createElement('div');
        originalItem.className = 'result-item';
        originalItem.innerHTML = `
          <div class="result-header">
            <div class="result-name">åŸå§‹æ–‡æœ¬</div>
            <span style="font-size: 0.8rem; color: #666;">${originalText.length} å­—ç¬¦</span>
          </div>
          <div class="result-value highlighted">${escapeHtml(originalText)}</div>
        `;
        
        const replacedItem = document.createElement('div');
        replacedItem.className = 'result-item';
        replacedItem.innerHTML = `
          <div class="result-header">
            <div class="result-name">æ›¿æ¢ç»“æœ</div>
            <span style="font-size: 0.8rem; color: #666;">${replacedText.length} å­—ç¬¦</span>
          </div>
          <div class="replace-result">${escapeHtml(replacedText)}</div>
        `;
        
        const statsItem = document.createElement('div');
        statsItem.className = 'result-item';
        statsItem.innerHTML = `
          <div class="result-header">
            <div class="result-name">æ›¿æ¢ç»Ÿè®¡</div>
          </div>
          <div class="result-value">
            æ­£åˆ™è¡¨è¾¾å¼: <code>${escapeHtml(regex.source)}</code><br>
            æ›¿æ¢æ–‡æœ¬: <code>${escapeHtml(replaceText.value || '(ç©º)')}</code><br>
            æ ‡å¿—: ${regex.flags || '(æ— )'}
          </div>
        `;
        
        resultsContainer.appendChild(originalItem);
        resultsContainer.appendChild(replacedItem);
        resultsContainer.appendChild(statsItem);
        
        resultsSection.style.display = 'block';
      }

      // æ¸…ç©ºæ‰€æœ‰
      function clearAll() {
        regexInput.value = '';
        testText.value = '';
        replaceText.value = '';
        highlightOutput.innerHTML = '';
        resultsSection.style.display = 'none';
        hideError();
        
        // é‡ç½®æ¨¡å¼
        modeG.checked = true;
        modeI.checked = false;
        modeM.checked = false;
        modeS.checked = false;
        modeU.checked = false;
      }

      // å®æ—¶æ›´æ–°é«˜äº®
      function updateHighlight() {
        const regexStr = regexInput.value.trim();
        const text = testText.value;
        
        if (regexStr && text) {
          try {
            highlightOutput.innerHTML = highlightMatches(text, regexStr);
            hideError();
          } catch (error) {
            highlightOutput.innerHTML = escapeHtml(text);
          }
        } else {
          highlightOutput.innerHTML = escapeHtml(text);
        }
      }

      // äº‹ä»¶ç›‘å¬å™¨
      testBtn.addEventListener('click', testRegex);
      replaceBtn.addEventListener('click', replaceTextHandler);
      clearBtn.addEventListener('click', clearAll);

      // å®æ—¶æ›´æ–°
      regexInput.addEventListener('input', updateHighlight);
      testText.addEventListener('input', updateHighlight);
      testText.addEventListener('scroll', function() {
        highlightOutput.scrollTop = this.scrollTop;
        highlightOutput.scrollLeft = this.scrollLeft;
      });

      // æ¨¡å¼åˆ‡æ¢æ—¶æ›´æ–°
      [modeG, modeI, modeM, modeS, modeU].forEach(mode => {
        mode.addEventListener('change', updateHighlight);
      });

      // å¿«é€Ÿç¤ºä¾‹æŒ‰é’®
      quickExampleBtns.forEach(btn => {
        btn.addEventListener('click', function() {
          const regex = this.getAttribute('data-regex');
          const text = this.getAttribute('data-text');
          
          regexInput.value = regex;
          testText.value = text;
          updateHighlight();
          
          // æ»šåŠ¨åˆ°è¾“å…¥æ¡†
          regexInput.focus();
        });
      });

      // åˆå§‹åŒ–é«˜äº®
      updateHighlight();

      // æ·»åŠ é”®ç›˜å¿«æ·é”®
      document.addEventListener('keydown', function(e) {
        if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
          e.preventDefault();
          testRegex();
        }
      });

      // åˆå§‹åŒ–é¡µé¢
      document.addEventListener('DOMContentLoaded', function() {
        // åˆå§‹é«˜äº®
        updateHighlight();
        
        // è‡ªåŠ¨è°ƒæ•´é«˜åº¦
        testText.addEventListener('input', function() {
          this.style.height = 'auto';
          this.style.height = (this.scrollHeight) + 'px';
        });
      });
    </script>
  </body>
</html>
