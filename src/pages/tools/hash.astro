---
// é¡µé¢å…ƒæ•°æ®
const pageTitle = "å“ˆå¸Œè®¡ç®—å™¨ - RuanTools";
const description = "è®¡ç®—æ–‡æœ¬å’Œæ–‡ä»¶çš„å“ˆå¸Œå€¼ï¼Œä»ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©ç®—æ³•";
---

<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <title>{pageTitle}</title>
    
    <!-- ä¸å†ä¾èµ–å¤–éƒ¨ CDNï¼Œå…¨éƒ¨ä½¿ç”¨åŸç”Ÿ API -->
    
    <style>
      /* åŸºç¡€æ ·å¼ */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        line-height: 1.6;
        color: #333;
        background: #f8f9fa;
        min-height: 100vh;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
      }

      /* å¤´éƒ¨æ ·å¼ */
      .header {
        margin-bottom: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2rem;
        font-weight: 600;
        margin-bottom: 8px;
        color: #1a1a1a;
      }

      .header p {
        color: #666;
        font-size: 0.95rem;
        max-width: 600px;
        margin: 0 auto;
      }

      /* å¡ç‰‡æ ·å¼ */
      .card {
        background: white;
        border-radius: 10px;
        padding: 25px;
        margin-bottom: 20px;
        border: 1px solid #e0e0e0;
      }

      .section-title {
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 20px;
        color: #2c3e50;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .section-title::before {
        content: "ğŸ”’";
        font-size: 1.1rem;
      }

      /* ç®—æ³•é€‰æ‹©å™¨ */
      .algorithm-selector {
        margin-bottom: 20px;
      }

      .select-group {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .select-label {
        font-size: 0.9rem;
        color: #555;
        font-weight: 500;
        min-width: 100px;
      }

      .select-field {
        flex: 1;
        padding: 10px 15px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 0.9rem;
        background: white;
        cursor: pointer;
        appearance: none;
        background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23666'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right 10px center;
        background-size: 16px;
        padding-right: 35px;
      }

      .select-field:focus {
        outline: none;
        border-color: #007bff;
        box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
      }

      .algorithm-info {
        font-size: 0.8rem;
        color: #666;
        margin-top: 8px;
        padding: 8px 12px;
        background: #f8f9fa;
        border-radius: 4px;
        border-left: 3px solid #007bff;
      }

      /* è¾“å…¥åŒºåŸŸ */
      .input-group {
        margin-bottom: 20px;
      }

      .input-label {
        display: block;
        margin-bottom: 8px;
        font-size: 0.9rem;
        color: #555;
        font-weight: 500;
      }

      .textarea-field {
        width: 100%;
        min-height: 120px;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
        font-size: 0.9rem;
        resize: vertical;
        background: #fafafa;
        transition: border-color 0.2s;
      }

      .textarea-field:focus {
        outline: none;
        border-color: #007bff;
        background: white;
      }

      .textarea-field::placeholder {
        color: #999;
      }

      /* æ–‡ä»¶ä¸Šä¼  */
      .file-upload {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
        padding: 15px;
        border: 2px dashed #ddd;
        border-radius: 6px;
        background: #fafafa;
      }

      .file-input {
        display: none;
      }

      .file-label {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 10px 20px;
        background: #007bff;
        color: white;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9rem;
        font-weight: 500;
        transition: background 0.2s;
      }

      .file-label:hover {
        background: #0056b3;
      }

      .file-name {
        font-size: 0.9rem;
        color: #666;
        flex: 1;
      }

      /* æŒ‰é’®ç»„ */
      .button-group {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 15px;
      }

      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        font-size: 0.9rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }

      .btn-primary {
        background: #007bff;
        color: white;
      }

      .btn-primary:hover {
        background: #0056b3;
      }

      .btn-outline {
        background: white;
        color: #555;
        border: 1px solid #ddd;
      }

      .btn-outline:hover {
        background: #f8f9fa;
        border-color: #bbb;
      }

      /* åŠ è½½æŒ‡ç¤ºå™¨ */
      .loading {
        display: none;
        align-items: center;
        gap: 10px;
        margin: 15px 0;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 6px;
        color: #666;
      }

      .loading-spinner {
        width: 20px;
        height: 20px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #007bff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      /* ç»“æœå±•ç¤º */
      .results {
        margin-top: 25px;
        display: none;
      }

      .result-title {
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 15px;
        color: #2c3e50;
      }

      .hash-item {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 15px;
        border: 1px solid #e0e0e0;
      }

      .hash-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
      }

      .hash-name {
        font-size: 1rem;
        font-weight: 600;
        color: #2c3e50;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .hash-bits {
        font-size: 0.75rem;
        color: #666;
        background: #e9ecef;
        padding: 2px 6px;
        border-radius: 10px;
      }

      .hash-value {
        font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
        font-size: 0.85rem;
        color: #333;
        word-break: break-all;
        margin-bottom: 10px;
        line-height: 1.4;
      }

      .hash-actions {
        display: flex;
        justify-content: flex-end;
      }

      .copy-btn {
        padding: 6px 12px;
        font-size: 0.8rem;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }

      .copy-btn:hover {
        background: #0056b3;
      }

      .copy-btn.copied {
        background: #28a745;
      }

      /* æ–‡ä»¶ä¿¡æ¯ */
      .file-info {
        display: none;
        margin-top: 20px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 8px;
        border: 1px solid #e0e0e0;
      }

      .file-info-title {
        font-size: 0.9rem;
        font-weight: 600;
        margin-bottom: 10px;
        color: #2c3e50;
      }

      .file-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 10px;
        font-size: 0.85rem;
      }

      .file-detail {
        display: flex;
        justify-content: space-between;
        padding: 5px 0;
        border-bottom: 1px solid #e9ecef;
      }

      .file-detail:last-child {
        border-bottom: none;
      }

      .detail-label {
        color: #666;
      }

      .detail-value {
        font-weight: 500;
        color: #333;
      }

      /* è¿›åº¦æ¡ */
      .progress {
        display: none;
        margin: 15px 0;
      }

      .progress-bar {
        width: 100%;
        height: 6px;
        background: #e9ecef;
        border-radius: 3px;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: #007bff;
        width: 0%;
        transition: width 0.3s;
      }

      .progress-text {
        font-size: 0.8rem;
        color: #666;
        margin-top: 5px;
        text-align: center;
      }

      /* é¡µè„š */
      .footer {
        text-align: center;
        margin-top: 40px;
        padding-top: 20px;
        border-top: 1px solid #e0e0e0;
        color: #666;
        font-size: 0.9rem;
      }

      /* å“åº”å¼è®¾è®¡ */
      @media (max-width: 768px) {
        .container {
          padding: 15px;
        }

        .select-group {
          flex-direction: column;
          align-items: stretch;
          gap: 8px;
        }

        .select-label {
          min-width: auto;
        }

        .button-group {
          flex-direction: column;
        }

        .btn {
          width: 100%;
          justify-content: center;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- å¤´éƒ¨ -->
      <header class="header">
        <h1>å“ˆå¸Œè®¡ç®—å™¨</h1>
        <p>è®¡ç®—æ–‡æœ¬å’Œæ–‡ä»¶çš„å“ˆå¸Œå€¼ï¼Œä»ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©ç®—æ³•</p>
      </header>

      <!-- ç®—æ³•é€‰æ‹© - ä¸‹æ‹‰èœå• -->
      <div class="card">
        <h2 class="section-title">é€‰æ‹©å“ˆå¸Œç®—æ³•</h2>
        
        <div class="algorithm-selector">
          <div class="select-group">
            <label class="select-label">ç®—æ³•é€‰æ‹©ï¼š</label>
            <select id="algorithm-select" class="select-field">
              <option value="sha256" selected>SHA-256 (256ä½)</option>
              <option value="sha1">SHA-1 (160ä½)</option>
              <option value="md5">MD5 (128ä½)</option>
              <option value="sha512">SHA-512 (512ä½)</option>
              <option value="sha384">SHA-384 (384ä½)</option>
            </select>
          </div>
          
          <div class="algorithm-info" id="algorithm-info">
            <strong>SHA-256</strong> - 256ä½SHA-2ç®—æ³•ï¼Œç›®å‰å¹¿æ³›ç”¨äºå®‰å…¨åº”ç”¨å’ŒåŒºå—é“¾æŠ€æœ¯
          </div>
        </div>
      </div>

      <!-- æ–‡æœ¬å“ˆå¸Œè®¡ç®— -->
      <div class="card">
        <h2 class="section-title">æ–‡æœ¬å“ˆå¸Œè®¡ç®—</h2>
        
        <div class="input-group">
          <label for="text-input" class="input-label">è¾“å…¥æ–‡æœ¬</label>
          <textarea 
            id="text-input" 
            class="textarea-field" 
            placeholder="åœ¨æ­¤è¾“å…¥è¦è®¡ç®—å“ˆå¸Œçš„æ–‡æœ¬..."
            rows="6"
          ></textarea>
        </div>

        <div class="button-group">
          <button id="calculate-text-btn" class="btn btn-primary">è®¡ç®—æ–‡æœ¬å“ˆå¸Œ</button>
          <button id="clear-text-btn" class="btn btn-outline">æ¸…ç©ºæ–‡æœ¬</button>
          <button id="example-text-btn" class="btn btn-outline">ä½¿ç”¨ç¤ºä¾‹</button>
        </div>

        <div id="text-loading" class="loading">
          <div class="loading-spinner"></div>
          <span>æ­£åœ¨è®¡ç®—å“ˆå¸Œå€¼...</span>
        </div>
      </div>

      <!-- æ–‡ä»¶å“ˆå¸Œè®¡ç®— -->
      <div class="card">
        <h2 class="section-title">æ–‡ä»¶å“ˆå¸Œè®¡ç®—</h2>
        
        <div class="file-upload">
          <input type="file" id="file-input" class="file-input" />
          <label for="file-input" class="file-label">
            <span>ğŸ“ é€‰æ‹©æ–‡ä»¶</span>
          </label>
          <div id="file-name" class="file-name">æœªé€‰æ‹©æ–‡ä»¶</div>
        </div>

        <div class="progress" id="file-progress">
          <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
          </div>
          <div class="progress-text" id="progress-text">0%</div>
        </div>

        <div class="button-group">
          <button id="calculate-file-btn" class="btn btn-primary" disabled>è®¡ç®—æ–‡ä»¶å“ˆå¸Œ</button>
          <button id="clear-file-btn" class="btn btn-outline">æ¸…é™¤æ–‡ä»¶</button>
        </div>

        <div id="file-loading" class="loading">
          <div class="loading-spinner"></div>
          <span>æ­£åœ¨è®¡ç®—æ–‡ä»¶å“ˆå¸Œ...</span>
        </div>

        <div id="file-info" class="file-info">
          <!-- æ–‡ä»¶ä¿¡æ¯å°†åœ¨è¿™é‡ŒåŠ¨æ€æ˜¾ç¤º -->
        </div>
      </div>

      <!-- ç»“æœæ˜¾ç¤º -->
      <div id="results-section" class="card" style="display: none;">
        <h3 class="result-title">å“ˆå¸Œè®¡ç®—ç»“æœ</h3>
        <div id="hash-results">
          <!-- å“ˆå¸Œç»“æœå°†åœ¨è¿™é‡ŒåŠ¨æ€æ˜¾ç¤º -->
        </div>
      </div>

      <!-- ä½¿ç”¨è¯´æ˜ -->
      <div class="card">
        <h2 class="section-title">ä½¿ç”¨è¯´æ˜</h2>
        <div style="color: #666; line-height: 1.6; font-size: 0.9rem;">
          <p><strong>æ”¯æŒçš„å“ˆå¸Œç®—æ³•ï¼š</strong></p>
          <ul style="padding-left: 20px; margin-top: 8px;">
            <li><strong>SHA-256</strong> - 256ä½SHA-2ç®—æ³•ï¼Œç›®å‰å¹¿æ³›ä½¿ç”¨ï¼ˆæ¨èï¼‰</li>
            <li><strong>SHA-1</strong> - 160ä½å“ˆå¸Œç®—æ³•ï¼Œå·²ä¸æ¨èç”¨äºå®‰å…¨ç”¨é€”</li>
            <li><strong>MD5</strong> - 128ä½å“ˆå¸Œç®—æ³•ï¼Œå¸¸ç”¨äºæ–‡ä»¶æ ¡éªŒ</li>
            <li><strong>SHA-512</strong> - 512ä½SHA-2ç®—æ³•ï¼Œæ›´å®‰å…¨çš„ç‰ˆæœ¬</li>
            <li><strong>SHA-384</strong> - 384ä½SHA-2ç®—æ³•</li>
          </ul>
          
          <p style="margin-top: 12px;"><strong>æŠ€æœ¯è¯´æ˜ï¼š</strong></p>
          <ul style="padding-left: 20px; margin-top: 8px;">
            <li>æœ¬å·¥å…·ä½¿ç”¨æµè§ˆå™¨è‡ªå¸¦çš„ Web Crypto APIï¼Œæ— éœ€åŠ è½½ä»»ä½•å¤–éƒ¨åº“</li>
            <li>å®Œå…¨ç¦»çº¿å·¥ä½œï¼Œä¿è¯æ•°æ®å®‰å…¨</li>
            <li>æ‰€æœ‰è®¡ç®—å‡åœ¨æ‚¨çš„æµè§ˆå™¨ä¸­æœ¬åœ°å®Œæˆ</li>
            <li>æ”¯æŒæ‰€æœ‰ç°ä»£æµè§ˆå™¨ï¼ˆChrome, Firefox, Safari, Edgeï¼‰</li>
          </ul>
          
          <p style="margin-top: 12px;"><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p>
          <ul style="padding-left: 20px; margin-top: 8px;">
            <li>æ¯æ¬¡åªèƒ½é€‰æ‹©ä¸€ç§å“ˆå¸Œç®—æ³•è¿›è¡Œè®¡ç®—</li>
            <li>å¤§æ–‡ä»¶è®¡ç®—å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…</li>
            <li>ç‚¹å‡»"å¤åˆ¶"æŒ‰é’®å¯ä»¥å¤åˆ¶å“ˆå¸Œå€¼</li>
            <li>æ–‡ä»¶ä¸ä¼šä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨ï¼Œå®Œå…¨æœ¬åœ°å¤„ç†</li>
          </ul>
        </div>
      </div>

      <!-- é¡µè„š -->
      <footer class="footer">
        <p>Â© 2024 RuanTools Â· å“ˆå¸Œè®¡ç®—å™¨</p>
        <p style="margin-top: 5px;">ä½¿ç”¨åŸç”Ÿ Web Crypto APIï¼Œæ— éœ€å¤–éƒ¨ä¾èµ–ï¼Œå®Œå…¨ç¦»çº¿å·¥ä½œ</p>
      </footer>
    </div>

    <script>
      // ç®—æ³•ä¿¡æ¯æ˜ å°„
      const algorithmInfo = {
        'sha256': 'SHA-256 - 256ä½SHA-2ç®—æ³•ï¼Œç›®å‰å¹¿æ³›ç”¨äºå®‰å…¨åº”ç”¨å’ŒåŒºå—é“¾æŠ€æœ¯',
        'sha1': 'SHA-1 - 160ä½å“ˆå¸Œç®—æ³•ï¼Œå·²å‘ç°ç¢°æ’æ”»å‡»ï¼Œä¸æ¨èç”¨äºå®‰å…¨ç”¨é€”',
        'md5': 'MD5 - 128ä½å“ˆå¸Œç®—æ³•ï¼Œå¸¸ç”¨äºæ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒï¼Œä½†å·²ä¸æ¨èç”¨äºå®‰å…¨ç”¨é€”',
        'sha512': 'SHA-512 - 512ä½SHA-2ç®—æ³•ï¼Œæä¾›æ›´é«˜çš„å®‰å…¨æ€§ï¼Œé€‚åˆåŠ å¯†ç”¨é€”',
        'sha384': 'SHA-384 - 384ä½SHA-2ç®—æ³•ï¼Œå¹³è¡¡æ€§èƒ½ä¸å®‰å…¨æ€§'
      };

      // ç®—æ³•åç§°æ˜ å°„
      const algorithmNames = {
        'md5': 'MD5',
        'sha1': 'SHA-1',
        'sha256': 'SHA-256',
        'sha384': 'SHA-384',
        'sha512': 'SHA-512'
      };

      // ç®—æ³•ä½æ•°æ˜ å°„
      const algorithmBits = {
        'md5': '128ä½',
        'sha1': '160ä½',
        'sha256': '256ä½',
        'sha384': '384ä½',
        'sha512': '512ä½'
      };

      // å½“å‰é€‰æ‹©çš„æ–‡ä»¶
      let selectedFile = null;

      // åˆå§‹åŒ–ä¸‹æ‹‰èœå•
      function initAlgorithmSelector() {
        const select = document.getElementById('algorithm-select');
        const info = document.getElementById('algorithm-info');
        
        // ç›‘å¬é€‰æ‹©å˜åŒ–
        select.addEventListener('change', function() {
          const selected = this.value;
          info.innerHTML = `<strong>${algorithmNames[selected] || selected}</strong> - ${algorithmInfo[selected] || ''}`;
        });
      }

      // è·å–å½“å‰é€‰ä¸­çš„ç®—æ³•
      function getSelectedAlgorithm() {
        const select = document.getElementById('algorithm-select');
        const algoId = select.value;
        return {
          id: algoId,
          name: algorithmNames[algoId] || algoId,
          bits: algorithmBits[algoId] || ''
        };
      }

      // ä½¿ç”¨ Web Crypto API è®¡ç®—å“ˆå¸Œ
      async function calculateHash(text, algorithm) {
        const encoder = new TextEncoder();
        const data = encoder.encode(text);
        
        // å°†ç®—æ³•åç§°è½¬æ¢ä¸º Web Crypto API å¯è¯†åˆ«çš„æ ¼å¼
        let cryptoAlgorithm;
        switch(algorithm) {
          case 'md5':
            // MD5 ä¸è¢« Web Crypto API æ”¯æŒï¼Œä½¿ç”¨æ›¿ä»£å®ç°
            return calculateMD5(text);
          case 'sha1':
            cryptoAlgorithm = 'SHA-1';
            break;
          case 'sha256':
            cryptoAlgorithm = 'SHA-256';
            break;
          case 'sha384':
            cryptoAlgorithm = 'SHA-384';
            break;
          case 'sha512':
            cryptoAlgorithm = 'SHA-512';
            break;
          default:
            cryptoAlgorithm = 'SHA-256';
        }
        
        try {
          const hashBuffer = await crypto.subtle.digest(cryptoAlgorithm, data);
          const hashArray = Array.from(new Uint8Array(hashBuffer));
          return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        } catch (error) {
          console.error('è®¡ç®—å“ˆå¸Œæ—¶å‡ºé”™:', error);
          throw error;
        }
      }

      // MD5 æ›¿ä»£å®ç°ï¼ˆå› ä¸º Web Crypto API ä¸æ”¯æŒ MD5ï¼‰
      function calculateMD5(text) {
        // ç®€å•çš„ MD5 å®ç°ï¼ˆç”¨äºå…¼å®¹æ€§ï¼‰
        // æ³¨æ„ï¼šè¿™æ˜¯ç®€åŒ–ç‰ˆæœ¬ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨å®Œæ•´çš„ MD5 å®ç°
        function md5cycle(x, k) {
          let a = x[0], b = x[1], c = x[2], d = x[3];
          
          a = ff(a, b, c, d, k[0], 7, -680876936);
          d = ff(d, a, b, c, k[1], 12, -389564586);
          c = ff(c, d, a, b, k[2], 17, 606105819);
          b = ff(b, c, d, a, k[3], 22, -1044525330);
          a = ff(a, b, c, d, k[4], 7, -176418897);
          d = ff(d, a, b, c, k[5], 12, 1200080426);
          c = ff(c, d, a, b, k[6], 17, -1473231341);
          b = ff(b, c, d, a, k[7], 22, -45705983);
          a = ff(a, b, c, d, k[8], 7, 1770035416);
          d = ff(d, a, b, c, k[9], 12, -1958414417);
          c = ff(c, d, a, b, k[10], 17, -42063);
          b = ff(b, c, d, a, k[11], 22, -1990404162);
          a = ff(a, b, c, d, k[12], 7, 1804603682);
          d = ff(d, a, b, c, k[13], 12, -40341101);
          c = ff(c, d, a, b, k[14], 17, -1502002290);
          b = ff(b, c, d, a, k[15], 22, 1236535329);
          
          a = gg(a, b, c, d, k[1], 5, -165796510);
          d = gg(d, a, b, c, k[6], 9, -1069501632);
          c = gg(c, d, a, b, k[11], 14, 643717713);
          b = gg(b, c, d, a, k[0], 20, -373897302);
          a = gg(a, b, c, d, k[5], 5, -701558691);
          d = gg(d, a, b, c, k[10], 9, 38016083);
          c = gg(c, d, a, b, k[15], 14, -660478335);
          b = gg(b, c, d, a, k[4], 20, -405537848);
          a = gg(a, b, c, d, k[9], 5, 568446438);
          d = gg(d, a, b, c, k[14], 9, -1019803690);
          c = gg(c, d, a, b, k[3], 14, -187363961);
          b = gg(b, c, d, a, k[8], 20, 1163531501);
          a = gg(a, b, c, d, k[13], 5, -1444681467);
          d = gg(d, a, b, c, k[2], 9, -51403784);
          c = gg(c, d, a, b, k[7], 14, 1735328473);
          b = gg(b, c, d, a, k[12], 20, -1926607734);
          
          a = hh(a, b, c, d, k[5], 4, -378558);
          d = hh(d, a, b, c, k[8], 11, -2022574463);
          c = hh(c, d, a, b, k[11], 16, 1839030562);
          b = hh(b, c, d, a, k[14], 23, -35309556);
          a = hh(a, b, c, d, k[1], 4, -1530992060);
          d = hh(d, a, b, c, k[4], 11, 1272893353);
          c = hh(c, d, a, b, k[7], 16, -155497632);
          b = hh(b, c, d, a, k[10], 23, -1094730640);
          a = hh(a, b, c, d, k[13], 4, 681279174);
          d = hh(d, a, b, c, k[0], 11, -358537222);
          c = hh(c, d, a, b, k[3], 16, -722521979);
          b = hh(b, c, d, a, k[6], 23, 76029189);
          a = hh(a, b, c, d, k[9], 4, -640364487);
          d = hh(d, a, b, c, k[12], 11, -421815835);
          c = hh(c, d, a, b, k[15], 16, 530742520);
          b = hh(b, c, d, a, k[2], 23, -995338651);
          
          a = ii(a, b, c, d, k[0], 6, -198630844);
          d = ii(d, a, b, c, k[7], 10, 1126891415);
          c = ii(c, d, a, b, k[14], 15, -1416354905);
          b = ii(b, c, d, a, k[5], 21, -57434055);
          a = ii(a, b, c, d, k[12], 6, 1700485571);
          d = ii(d, a, b, c, k[3], 10, -1894986606);
          c = ii(c, d, a, b, k[10], 15, -1051523);
          b = ii(b, c, d, a, k[1], 21, -2054922799);
          a = ii(a, b, c, d, k[8], 6, 1873313359);
          d = ii(d, a, b, c, k[15], 10, -30611744);
          c = ii(c, d, a, b, k[6], 15, -1560198380);
          b = ii(b, c, d, a, k[13], 21, 1309151649);
          a = ii(a, b, c, d, k[4], 6, -145523070);
          d = ii(d, a, b, c, k[11], 10, -1120210379);
          c = ii(c, d, a, b, k[2], 15, 718787259);
          b = ii(b, c, d, a, k[9], 21, -343485551);
          
          x[0] = add32(a, x[0]);
          x[1] = add32(b, x[1]);
          x[2] = add32(c, x[2]);
          x[3] = add32(d, x[3]);
        }
        
        function cmn(q, a, b, x, s, t) {
          a = add32(add32(a, q), add32(x, t));
          return add32((a << s) | (a >>> (32 - s)), b);
        }
        
        function ff(a, b, c, d, x, s, t) {
          return cmn((b & c) | ((~b) & d), a, b, x, s, t);
        }
        
        function gg(a, b, c, d, x, s, t) {
          return cmn((b & d) | (c & (~d)), a, b, x, s, t);
        }
        
        function hh(a, b, c, d, x, s, t) {
          return cmn(b ^ c ^ d, a, b, x, s, t);
        }
        
        function ii(a, b, c, d, x, s, t) {
          return cmn(c ^ (b | (~d)), a, b, x, s, t);
        }
        
        function md51(s) {
          const n = s.length;
          const state = [1732584193, -271733879, -1732584194, 271733878];
          let i;
          
          for (i = 64; i <= n; i += 64) {
            md5cycle(state, md5blk(s.substring(i - 64, i)));
          }
          
          s = s.substring(i - 64);
          const tail = [0,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,0];
          for (i = 0; i < s.length; i++) {
            tail[i >> 2] |= s.charCodeAt(i) << ((i % 4) << 3);
          }
          tail[i >> 2] |= 0x80 << ((i % 4) << 3);
          if (i > 55) {
            md5cycle(state, tail);
            for (i = 0; i < 16; i++) tail[i] = 0;
          }
          
          tail[14] = n * 8;
          md5cycle(state, tail);
          return state;
        }
        
        function md5blk(s) {
          const md5blks = [];
          for (let i = 0; i < 64; i += 4) {
            md5blks[i >> 2] = s.charCodeAt(i) +
              (s.charCodeAt(i + 1) << 8) +
              (s.charCodeAt(i + 2) << 16) +
              (s.charCodeAt(i + 3) << 24);
          }
          return md5blks;
        }
        
        function add32(a, b) {
          return (a + b) & 0xFFFFFFFF;
        }
        
        function hex(x) {
          for (let i = 0; i < x.length; i++) {
            x[i] = ('0' + (x[i] & 0xFF).toString(16)).slice(-2);
          }
          return x.join('');
        }
        
        function hexMD5(s) {
          return hex(md51(s));
        }
        
        return hexMD5(text);
      }

      // è®¡ç®—æ–‡æœ¬å“ˆå¸Œ
      async function calculateTextHash() {
        const text = document.getElementById('text-input').value.trim();
        if (!text) {
          alert('è¯·è¾“å…¥æ–‡æœ¬');
          return;
        }

        const algorithm = getSelectedAlgorithm();
        
        showLoading('text');
        
        try {
          const hash = await calculateHash(text, algorithm.id);
          displayResult(algorithm, hash);
        } catch (error) {
          console.error('è®¡ç®—å“ˆå¸Œæ—¶å‡ºé”™:', error);
          alert('è®¡ç®—å“ˆå¸Œæ—¶å‡ºé”™: ' + error.message);
        } finally {
          hideLoading('text');
        }
      }

      // è®¡ç®—æ–‡ä»¶å“ˆå¸Œ
      async function calculateFileHash() {
        if (!selectedFile) {
          alert('è¯·é€‰æ‹©æ–‡ä»¶');
          return;
        }

        const algorithm = getSelectedAlgorithm();

        showLoading('file');
        showProgress(0);

        try {
          const file = selectedFile;
          const hash = await calculateFileHashWithProgress(file, algorithm.id);
          
          // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
          showFileInfo(file);
          
          // æ˜¾ç¤ºç»“æœ
          displayResult(algorithm, hash);
          
        } catch (error) {
          console.error('å¤„ç†æ–‡ä»¶æ—¶å‡ºé”™:', error);
          alert('å¤„ç†æ–‡ä»¶æ—¶å‡ºé”™: ' + error.message);
        } finally {
          hideLoading('file');
          hideProgress();
        }
      }

      // è®¡ç®—æ–‡ä»¶å“ˆå¸Œï¼ˆå¸¦è¿›åº¦æ˜¾ç¤ºï¼‰
      async function calculateFileHashWithProgress(file, algorithm) {
        return new Promise((resolve, reject) => {
          const fileSize = file.size;
          const chunkSize = 1024 * 1024; // 1MB chunks
          const chunks = Math.ceil(fileSize / chunkSize);
          let currentChunk = 0;
          
          const reader = new FileReader();
          const cryptoAlgorithm = getCryptoAlgorithmName(algorithm);
          
          // åˆå§‹åŒ–åŠ å¯†ä¸Šä¸‹æ–‡
          if (algorithm === 'md5') {
            // MD5 éœ€è¦ç‰¹æ®Šå¤„ç†
            const md5Chunks = [];
            
            reader.onload = function(e) {
              const arrayBuffer = e.target.result;
              md5Chunks.push(new Uint8Array(arrayBuffer));
              
              currentChunk++;
              showProgress((currentChunk / chunks) * 100);
              
              if (currentChunk < chunks) {
                loadNextChunk();
              } else {
                // æ‰€æœ‰å—è¯»å–å®Œæˆï¼Œè®¡ç®— MD5
                const combined = new Uint8Array(fileSize);
                let offset = 0;
                for (const chunk of md5Chunks) {
                  combined.set(chunk, offset);
                  offset += chunk.length;
                }
                
                const text = new TextDecoder().decode(combined);
                const hash = calculateMD5(text);
                resolve(hash);
              }
            };
          } else {
            // ä½¿ç”¨ Web Crypto API
            crypto.subtle.digest(cryptoAlgorithm, new ArrayBuffer(0))
              .then(hashBuffer => {
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                const hash = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
                resolve(hash);
              })
              .catch(reject);
          }
          
          function loadNextChunk() {
            const start = currentChunk * chunkSize;
            const end = Math.min(start + chunkSize, fileSize);
            const slice = file.slice(start, end);
            reader.readAsArrayBuffer(slice);
          }
          
          reader.onerror = reject;
          loadNextChunk();
        });
      }

      // è·å– Web Crypto API ç®—æ³•åç§°
      function getCryptoAlgorithmName(algorithm) {
        switch(algorithm) {
          case 'sha1': return 'SHA-1';
          case 'sha256': return 'SHA-256';
          case 'sha384': return 'SHA-384';
          case 'sha512': return 'SHA-512';
          default: return 'SHA-256';
        }
      }

      // æ˜¾ç¤ºå•ä¸ªç»“æœ
      function displayResult(algorithm, hash) {
        const resultsSection = document.getElementById('results-section');
        const hashResults = document.getElementById('hash-results');
        
        resultsSection.style.display = 'block';
        hashResults.innerHTML = '';
        
        const hashItem = document.createElement('div');
        hashItem.className = 'hash-item';
        hashItem.innerHTML = `
          <div class="hash-header">
            <div class="hash-name">
              <span>${algorithm.name}</span>
              <span class="hash-bits">${algorithm.bits}</span>
            </div>
            <span style="font-size: 0.8rem; color: #666;">${hash.length} å­—ç¬¦</span>
          </div>
          <div class="hash-value">${hash}</div>
          <div class="hash-actions">
            <button class="copy-btn" data-hash="${hash}">å¤åˆ¶å“ˆå¸Œå€¼</button>
          </div>
        `;
        
        hashResults.appendChild(hashItem);
        
        // ä¸ºå¤åˆ¶æŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
        const copyBtn = hashItem.querySelector('.copy-btn');
        copyBtn.addEventListener('click', function() {
          const hash = this.getAttribute('data-hash');
          copyToClipboard(hash, this);
        });
        
        // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
        resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }

      // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
      function showFileInfo(file) {
        const fileInfo = document.getElementById('file-info');
        fileInfo.style.display = 'block';
        fileInfo.innerHTML = `
          <div class="file-info-title">æ–‡ä»¶ä¿¡æ¯</div>
          <div class="file-details">
            <div class="file-detail">
              <span class="detail-label">æ–‡ä»¶å:</span>
              <span class="detail-value">${file.name}</span>
            </div>
            <div class="file-detail">
              <span class="detail-label">æ–‡ä»¶å¤§å°:</span>
              <span class="detail-value">${formatFileSize(file.size)}</span>
            </div>
            <div class="file-detail">
              <span class="detail-label">ä¿®æ”¹æ—¶é—´:</span>
              <span class="detail-value">${new Date(file.lastModified).toLocaleString()}</span>
            </div>
            <div class="file-detail">
              <span class="detail-label">æ–‡ä»¶ç±»å‹:</span>
              <span class="detail-value">${file.type || 'æœªçŸ¥'}</span>
            </div>
          </div>
        `;
      }

      function formatFileSize(bytes) {
        if (bytes === 0) return '0 B';
        const k = 1024;
        const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
      }

      function showLoading(type) {
        document.getElementById(`${type}-loading`).style.display = 'flex';
      }

      function hideLoading(type) {
        document.getElementById(`${type}-loading`).style.display = 'none';
      }

      function showProgress(percent) {
        const progress = document.getElementById('file-progress');
        const fill = document.getElementById('progress-fill');
        const text = document.getElementById('progress-text');
        
        progress.style.display = 'block';
        fill.style.width = `${percent}%`;
        text.textContent = `${Math.round(percent)}%`;
      }

      function hideProgress() {
        document.getElementById('file-progress').style.display = 'none';
      }

      async function copyToClipboard(text, button) {
        try {
          await navigator.clipboard.writeText(text);
          button.textContent = 'å·²å¤åˆ¶';
          button.classList.add('copied');
          setTimeout(() => {
            button.textContent = 'å¤åˆ¶å“ˆå¸Œå€¼';
            button.classList.remove('copied');
          }, 2000);
        } catch (err) {
          const textArea = document.createElement('textarea');
          textArea.value = text;
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand('copy');
          document.body.removeChild(textArea);
          button.textContent = 'å·²å¤åˆ¶';
          button.classList.add('copied');
          setTimeout(() => {
            button.textContent = 'å¤åˆ¶å“ˆå¸Œå€¼';
            button.classList.remove('copied');
          }, 2000);
        }
      }

      // åˆå§‹åŒ–é¡µé¢
      document.addEventListener('DOMContentLoaded', function() {
        // åˆå§‹åŒ–ç®—æ³•é€‰æ‹©å™¨
        initAlgorithmSelector();
        
        // æ–‡æœ¬è®¡ç®—æŒ‰é’®äº‹ä»¶
        document.getElementById('calculate-text-btn').addEventListener('click', calculateTextHash);
        
        // æ¸…ç©ºæ–‡æœ¬æŒ‰é’®äº‹ä»¶
        document.getElementById('clear-text-btn').addEventListener('click', function() {
          document.getElementById('text-input').value = '';
        });
        
        // ç¤ºä¾‹æ–‡æœ¬æŒ‰é’®äº‹ä»¶
        document.getElementById('example-text-btn').addEventListener('click', function() {
          document.getElementById('text-input').value = 'Hello, World! è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ–‡æœ¬ï¼Œç”¨äºè®¡ç®—å“ˆå¸Œå€¼ã€‚';
        });
        
        // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
        document.getElementById('file-input').addEventListener('change', function(e) {
          const file = e.target.files[0];
          if (file) {
            selectedFile = file;
            document.getElementById('file-name').textContent = `${file.name} (${formatFileSize(file.size)})`;
            document.getElementById('calculate-file-btn').disabled = false;
          } else {
            selectedFile = null;
            document.getElementById('file-name').textContent = 'æœªé€‰æ‹©æ–‡ä»¶';
            document.getElementById('calculate-file-btn').disabled = true;
          }
        });
        
        // æ–‡ä»¶è®¡ç®—æŒ‰é’®äº‹ä»¶
        document.getElementById('calculate-file-btn').addEventListener('click', calculateFileHash);
        
        // æ¸…é™¤æ–‡ä»¶æŒ‰é’®äº‹ä»¶
        document.getElementById('clear-file-btn').addEventListener('click', function() {
          document.getElementById('file-input').value = '';
          selectedFile = null;
          document.getElementById('file-name').textContent = 'æœªé€‰æ‹©æ–‡ä»¶';
          document.getElementById('calculate-file-btn').disabled = true;
        });
        
        // æ–‡æœ¬è¾“å…¥æ¡† Ctrl+Enter è®¡ç®—
        document.getElementById('text-input').addEventListener('keydown', function(e) {
          if (e.ctrlKey && e.key === 'Enter') {
            calculateTextHash();
          }
        });
      });
    </script>
  </body>
</html>
