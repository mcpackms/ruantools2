---
// é¡µé¢å…ƒæ•°æ®
const pageTitle = "å“ˆå¸Œè®¡ç®—å™¨ - RuanTools";
const description = "è®¡ç®—æ–‡æœ¬å’Œæ–‡ä»¶çš„ MD5ã€SHA-1ã€SHA-256ã€SHA-512ã€SHA-3ã€BLAKE2b ç­‰å¤šç§å“ˆå¸Œå€¼ã€‚";
---

<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <title>{pageTitle}</title>
    <style>
      /* åŸºç¡€æ ·å¼ */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        line-height: 1.6;
        color: #333;
        background: #f8f9fa;
        min-height: 100vh;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
      }

      /* å¤´éƒ¨æ ·å¼ */
      .header {
        margin-bottom: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2rem;
        font-weight: 600;
        margin-bottom: 8px;
        color: #1a1a1a;
      }

      .header p {
        color: #666;
        font-size: 0.95rem;
        max-width: 600px;
        margin: 0 auto;
      }

      /* å¡ç‰‡æ ·å¼ */
      .card {
        background: white;
        border-radius: 10px;
        padding: 25px;
        margin-bottom: 20px;
        border: 1px solid #e0e0e0;
      }

      .section-title {
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 20px;
        color: #2c3e50;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .section-title::before {
        content: "ğŸ”’";
        font-size: 1.1rem;
      }

      /* ç®—æ³•é€‰æ‹© */
      .algorithm-selector {
        margin-bottom: 20px;
      }

      .algorithm-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 10px;
        margin-top: 10px;
      }

      .algorithm-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 0.9rem;
      }

      .algorithm-item:hover {
        background: #f8f9fa;
        border-color: #bbb;
      }

      .algorithm-item.selected {
        background: #007bff;
        color: white;
        border-color: #007bff;
      }

      .algorithm-checkbox {
        width: 16px;
        height: 16px;
        margin: 0;
      }

      .algorithm-name {
        font-weight: 500;
      }

      .algorithm-bits {
        font-size: 0.8rem;
        opacity: 0.7;
        margin-left: auto;
      }

      .algorithm-item.selected .algorithm-bits {
        color: rgba(255, 255, 255, 0.9);
      }

      /* è¾“å…¥åŒºåŸŸ */
      .input-group {
        margin-bottom: 20px;
      }

      .input-label {
        display: block;
        margin-bottom: 8px;
        font-size: 0.9rem;
        color: #555;
        font-weight: 500;
      }

      .textarea-field {
        width: 100%;
        min-height: 120px;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
        font-size: 0.9rem;
        resize: vertical;
        background: #fafafa;
        transition: border-color 0.2s;
      }

      .textarea-field:focus {
        outline: none;
        border-color: #007bff;
        background: white;
      }

      /* æ–‡ä»¶ä¸Šä¼  */
      .file-upload {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
        padding: 15px;
        border: 2px dashed #ddd;
        border-radius: 6px;
        background: #fafafa;
      }

      .file-input {
        display: none;
      }

      .file-label {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 10px 20px;
        background: #007bff;
        color: white;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9rem;
        font-weight: 500;
        transition: background 0.2s;
      }

      .file-label:hover {
        background: #0056b3;
      }

      .file-name {
        font-size: 0.9rem;
        color: #666;
        flex: 1;
      }

      /* æŒ‰é’®ç»„ */
      .button-group {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 15px;
      }

      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        font-size: 0.9rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }

      .btn-primary {
        background: #007bff;
        color: white;
      }

      .btn-primary:hover {
        background: #0056b3;
      }

      .btn-outline {
        background: white;
        color: #555;
        border: 1px solid #ddd;
      }

      .btn-outline:hover {
        background: #f8f9fa;
        border-color: #bbb;
      }

      /* åŠ è½½æŒ‡ç¤ºå™¨ */
      .loading {
        display: none;
        align-items: center;
        gap: 10px;
        margin: 15px 0;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 6px;
        color: #666;
      }

      .loading-spinner {
        width: 20px;
        height: 20px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #007bff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      /* ç»“æœå±•ç¤º */
      .results {
        margin-top: 25px;
        display: none;
      }

      .result-title {
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 15px;
        color: #2c3e50;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .copy-all-btn {
        padding: 6px 12px;
        font-size: 0.8rem;
        background: #28a745;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }

      .copy-all-btn:hover {
        background: #218838;
      }

      .hash-results {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 15px;
      }

      @media (max-width: 768px) {
        .hash-results {
          grid-template-columns: 1fr;
        }
      }

      .hash-item {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 15px;
        border: 1px solid #e0e0e0;
      }

      .hash-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .hash-name {
        font-size: 0.9rem;
        font-weight: 600;
        color: #2c3e50;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .hash-bits {
        font-size: 0.75rem;
        color: #666;
        background: #e9ecef;
        padding: 2px 6px;
        border-radius: 10px;
      }

      .hash-value {
        font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
        font-size: 0.85rem;
        color: #333;
        word-break: break-all;
        margin-bottom: 10px;
      }

      .hash-actions {
        display: flex;
        gap: 8px;
      }

      .copy-btn {
        padding: 4px 8px;
        font-size: 0.75rem;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }

      .copy-btn:hover {
        background: #0056b3;
      }

      .copy-btn.copied {
        background: #28a745;
      }

      /* æ–‡ä»¶ä¿¡æ¯ */
      .file-info {
        display: none;
        margin-top: 20px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 8px;
        border: 1px solid #e0e0e0;
      }

      .file-info-title {
        font-size: 0.9rem;
        font-weight: 600;
        margin-bottom: 10px;
        color: #2c3e50;
      }

      .file-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 10px;
        font-size: 0.85rem;
      }

      .file-detail {
        display: flex;
        justify-content: space-between;
        padding: 5px 0;
        border-bottom: 1px solid #e9ecef;
      }

      .file-detail:last-child {
        border-bottom: none;
      }

      .detail-label {
        color: #666;
      }

      .detail-value {
        font-weight: 500;
        color: #333;
      }

      /* è¿›åº¦æ¡ */
      .progress {
        display: none;
        margin: 15px 0;
      }

      .progress-bar {
        width: 100%;
        height: 6px;
        background: #e9ecef;
        border-radius: 3px;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: #007bff;
        width: 0%;
        transition: width 0.3s;
      }

      .progress-text {
        font-size: 0.8rem;
        color: #666;
        margin-top: 5px;
        text-align: center;
      }

      /* é¡µè„š */
      .footer {
        text-align: center;
        margin-top: 40px;
        padding-top: 20px;
        border-top: 1px solid #e0e0e0;
        color: #666;
        font-size: 0.9rem;
      }

      /* æš—è‰²æ¨¡å¼æ”¯æŒ */
      @media (prefers-color-scheme: dark) {
        body {
          background: #1a1a1a;
          color: #e0e0e0;
        }

        .header h1 {
          color: #ffffff;
        }

        .header p {
          color: #aaa;
        }

        .card {
          background: #2d2d2d;
          border-color: #444;
        }

        .algorithm-item {
          background: #333;
          border-color: #555;
          color: #e0e0e0;
        }

        .algorithm-item:hover {
          background: #3a3a3a;
        }

        .algorithm-item.selected {
          background: #007bff;
          border-color: #007bff;
        }

        .textarea-field {
          background: #333;
          border-color: #555;
          color: #e0e0e0;
        }

        .textarea-field:focus {
          background: #3a3a3a;
          border-color: #007bff;
        }

        .file-upload {
          background: #333;
          border-color: #555;
        }

        .file-name {
          color: #aaa;
        }

        .btn-outline {
          background: #333;
          color: #e0e0e0;
          border-color: #555;
        }

        .btn-outline:hover {
          background: #444;
        }

        .loading {
          background: #333;
          color: #aaa;
        }

        .hash-item {
          background: #333;
          border-color: #444;
        }

        .hash-name {
          color: #e0e0e0;
        }

        .hash-bits {
          background: #444;
          color: #aaa;
        }

        .hash-value {
          color: #e0e0e0;
        }

        .file-info {
          background: #333;
          border-color: #444;
        }

        .detail-label {
          color: #aaa;
        }

        .detail-value {
          color: #e0e0e0;
        }

        .footer {
          border-color: #444;
          color: #aaa;
        }
      }

      /* å“åº”å¼è®¾è®¡ */
      @media (max-width: 768px) {
        .container {
          padding: 15px;
        }

        .algorithm-grid {
          grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        }

        .button-group {
          flex-direction: column;
        }

        .btn {
          width: 100%;
          justify-content: center;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- å¤´éƒ¨ -->
      <header class="header">
        <h1>å“ˆå¸Œè®¡ç®—å™¨</h1>
        <p>è®¡ç®—æ–‡æœ¬å’Œæ–‡ä»¶çš„ MD5ã€SHA ç³»åˆ—ã€BLAKE2b ç­‰å¤šç§å“ˆå¸Œå€¼</p>
      </header>

      <!-- ç®—æ³•é€‰æ‹© -->
      <div class="card">
        <h2 class="section-title">é€‰æ‹©å“ˆå¸Œç®—æ³•</h2>
        <div class="algorithm-grid" id="algorithm-grid">
          <!-- ç®—æ³•é€‰é¡¹å°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆ -->
        </div>
      </div>

      <!-- æ–‡æœ¬å“ˆå¸Œè®¡ç®— -->
      <div class="card">
        <h2 class="section-title">æ–‡æœ¬å“ˆå¸Œè®¡ç®—</h2>
        
        <div class="input-group">
          <label for="text-input" class="input-label">è¾“å…¥æ–‡æœ¬</label>
          <textarea 
            id="text-input" 
            class="textarea-field" 
            placeholder="åœ¨æ­¤è¾“å…¥è¦è®¡ç®—å“ˆå¸Œçš„æ–‡æœ¬..."
            rows="6"
          ></textarea>
        </div>

        <div class="button-group">
          <button id="calculate-text-btn" class="btn btn-primary">è®¡ç®—æ–‡æœ¬å“ˆå¸Œ</button>
          <button id="clear-text-btn" class="btn btn-outline">æ¸…ç©ºæ–‡æœ¬</button>
          <button id="example-text-btn" class="btn btn-outline">ä½¿ç”¨ç¤ºä¾‹</button>
        </div>

        <div id="text-loading" class="loading">
          <div class="loading-spinner"></div>
          <span>æ­£åœ¨è®¡ç®—å“ˆå¸Œå€¼...</span>
        </div>
      </div>

      <!-- æ–‡ä»¶å“ˆå¸Œè®¡ç®— -->
      <div class="card">
        <h2 class="section-title">æ–‡ä»¶å“ˆå¸Œè®¡ç®—</h2>
        
        <div class="file-upload">
          <input type="file" id="file-input" class="file-input" />
          <label for="file-input" class="file-label">
            <span>ğŸ“ é€‰æ‹©æ–‡ä»¶</span>
          </label>
          <div id="file-name" class="file-name">æœªé€‰æ‹©æ–‡ä»¶</div>
        </div>

        <div class="progress" id="file-progress">
          <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
          </div>
          <div class="progress-text" id="progress-text">0%</div>
        </div>

        <div class="button-group">
          <button id="calculate-file-btn" class="btn btn-primary" disabled>è®¡ç®—æ–‡ä»¶å“ˆå¸Œ</button>
          <button id="clear-file-btn" class="btn btn-outline">æ¸…é™¤æ–‡ä»¶</button>
        </div>

        <div id="file-loading" class="loading">
          <div class="loading-spinner"></div>
          <span>æ­£åœ¨è®¡ç®—æ–‡ä»¶å“ˆå¸Œ...</span>
        </div>

        <div id="file-info" class="file-info">
          <!-- æ–‡ä»¶ä¿¡æ¯å°†åœ¨è¿™é‡ŒåŠ¨æ€æ˜¾ç¤º -->
        </div>
      </div>

      <!-- ç»“æœæ˜¾ç¤º -->
      <div id="results-section" class="card" style="display: none;">
        <div class="result-title">
          <span>å“ˆå¸Œè®¡ç®—ç»“æœ</span>
          <button id="copy-all-btn" class="copy-all-btn">å¤åˆ¶æ‰€æœ‰</button>
        </div>
        
        <div id="hash-results" class="hash-results">
          <!-- å“ˆå¸Œç»“æœå°†åœ¨è¿™é‡ŒåŠ¨æ€æ˜¾ç¤º -->
        </div>
      </div>

      <!-- ä½¿ç”¨è¯´æ˜ -->
      <div class="card">
        <h2 class="section-title">ä½¿ç”¨è¯´æ˜</h2>
        <div style="color: #666; line-height: 1.6; font-size: 0.9rem;">
          <p><strong>æ”¯æŒçš„å“ˆå¸Œç®—æ³•ï¼š</strong></p>
          <ul style="padding-left: 20px; margin-top: 8px;">
            <li><strong>MD5</strong> - 128ä½å“ˆå¸Œï¼Œå¸¸ç”¨äºæ–‡ä»¶æ ¡éªŒ</li>
            <li><strong>SHA-1</strong> - 160ä½å“ˆå¸Œï¼Œå·²ä¸æ¨èç”¨äºå®‰å…¨ç”¨é€”</li>
            <li><strong>SHA-256</strong> - 256ä½SHA-2ç®—æ³•ï¼Œç›®å‰å¹¿æ³›ä½¿ç”¨</li>
            <li><strong>SHA-512</strong> - 512ä½SHA-2ç®—æ³•ï¼Œæ›´å®‰å…¨çš„ç‰ˆæœ¬</li>
            <li><strong>SHA-3-256</strong> - 256ä½SHA-3ç®—æ³•ï¼Œæ–°ä¸€ä»£æ ‡å‡†</li>
            <li><strong>SHA-3-512</strong> - 512ä½SHA-3ç®—æ³•</li>
            <li><strong>BLAKE2b</strong> - é«˜é€Ÿå“ˆå¸Œç®—æ³•ï¼Œæ€§èƒ½ä¼˜äºSHA-2/3</li>
          </ul>
          
          <p style="margin-top: 12px;"><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p>
          <ul style="padding-left: 20px; margin-top: 8px;">
            <li>æ‰€æœ‰è®¡ç®—å‡åœ¨æµè§ˆå™¨æœ¬åœ°å®Œæˆï¼Œæ–‡ä»¶ä¸ä¼šä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨</li>
            <li>å¤§æ–‡ä»¶è®¡ç®—å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…</li>
            <li>å¯¹äºå¤§æ–‡ä»¶ï¼Œå»ºè®®ä½¿ç”¨è¾ƒæ–°çš„æµè§ˆå™¨ä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½</li>
            <li>ç‚¹å‡»"å¤åˆ¶"æŒ‰é’®å¯ä»¥å¤åˆ¶å•ä¸ªå“ˆå¸Œå€¼ï¼Œç‚¹å‡»"å¤åˆ¶æ‰€æœ‰"å¯ä»¥å¤åˆ¶å…¨éƒ¨</li>
          </ul>

          <p style="margin-top: 12px;"><strong>æŠ€æœ¯è¯´æ˜ï¼š</strong></p>
          <ul style="padding-left: 20px; margin-top: 8px;">
            <li>MD5ã€SHA-1ã€SHA-256ã€SHA-512 ä½¿ç”¨ CryptoJS åº“</li>
            <li>SHA-3-256ã€SHA-3-512 ä½¿ç”¨ js-sha3 åº“</li>
            <li>BLAKE2b ä½¿ç”¨ blake2b-wasm åº“ï¼ˆWebAssemblyï¼‰</li>
            <li>æ‰€æœ‰è®¡ç®—å‡åœ¨æµè§ˆå™¨ä¸­æœ¬åœ°æ‰§è¡Œï¼Œä¿è¯æ•°æ®å®‰å…¨</li>
          </ul>
        </div>
      </div>

      <!-- é¡µè„š -->
      <footer class="footer">
        <p>Â© 2024 RuanTools Â· å“ˆå¸Œè®¡ç®—å™¨</p>
        <p style="margin-top: 5px;">æ‰€æœ‰è®¡ç®—å‡åœ¨æµè§ˆå™¨æœ¬åœ°å®Œæˆï¼Œä¿è¯æ•°æ®å®‰å…¨</p>
      </footer>
    </div>

    <script>
      // å¯¼å…¥å·²å®‰è£…çš„åº“ï¼ˆé€šè¿‡ npm å®‰è£…ï¼‰
      // æ³¨æ„ï¼šè¿™äº›åº“éœ€è¦åœ¨æ„å»ºæ—¶è¢«å¤„ç†
      import CryptoJS from 'crypto-js';
      import { sha3_256, sha3_512 } from 'js-sha3';
      
      // åˆå§‹åŒ–ç®—æ³•åˆ—è¡¨
      const algorithms = [
        { id: 'md5', name: 'MD5', bits: '128ä½', selected: true },
        { id: 'sha1', name: 'SHA-1', bits: '160ä½', selected: true },
        { id: 'sha256', name: 'SHA-256', bits: '256ä½', selected: true },
        { id: 'sha512', name: 'SHA-512', bits: '512ä½', selected: true },
        { id: 'sha3-256', name: 'SHA-3-256', bits: '256ä½', selected: true },
        { id: 'sha3-512', name: 'SHA-3-512', bits: '512ä½', selected: true },
        { id: 'blake2b', name: 'BLAKE2b', bits: '512ä½', selected: true }
      ];

      // åŠ¨æ€å¯¼å…¥ blake2b-wasm
      let blake2bPromise = null;
      let blake2b = null;

      async function loadBlake2b() {
        if (!blake2bPromise) {
          blake2bPromise = import('blake2b-wasm').then(module => {
            blake2b = module.default;
            return blake2b;
          }).catch(err => {
            console.error('åŠ è½½ BLAKE2b åº“å¤±è´¥:', err);
            return null;
          });
        }
        return blake2bPromise;
      }

      // å½“å‰é€‰æ‹©çš„æ–‡ä»¶
      let selectedFile = null;

      // åˆå§‹åŒ–ç®—æ³•é€‰æ‹©å™¨
      function initAlgorithmSelector() {
        const grid = document.getElementById('algorithm-grid');
        grid.innerHTML = '';
        
        algorithms.forEach(algo => {
          const item = document.createElement('div');
          item.className = `algorithm-item ${algo.selected ? 'selected' : ''}`;
          item.innerHTML = `
            <input type="checkbox" class="algorithm-checkbox" id="algo-${algo.id}" ${algo.selected ? 'checked' : ''}>
            <span class="algorithm-name">${algo.name}</span>
            <span class="algorithm-bits">${algo.bits}</span>
          `;
          
          item.addEventListener('click', (e) => {
            if (e.target.type !== 'checkbox') {
              const checkbox = item.querySelector('.algorithm-checkbox');
              checkbox.checked = !checkbox.checked;
              algo.selected = checkbox.checked;
              item.classList.toggle('selected');
            }
          });
          
          const checkbox = item.querySelector('.algorithm-checkbox');
          checkbox.addEventListener('change', (e) => {
            e.stopPropagation();
            algo.selected = checkbox.checked;
            item.classList.toggle('selected');
          });
          
          grid.appendChild(item);
        });
      }

      // è·å–é€‰ä¸­çš„ç®—æ³•
      function getSelectedAlgorithms() {
        return algorithms.filter(algo => algo.selected);
      }

      // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
      function showLoading(type) {
        if (type === 'text') {
          document.getElementById('text-loading').style.display = 'flex';
        } else if (type === 'file') {
          document.getElementById('file-loading').style.display = 'flex';
        }
      }

      // éšè—åŠ è½½çŠ¶æ€
      function hideLoading(type) {
        if (type === 'text') {
          document.getElementById('text-loading').style.display = 'none';
        } else if (type === 'file') {
          document.getElementById('file-loading').style.display = 'none';
        }
      }

      // æ˜¾ç¤ºè¿›åº¦æ¡
      function showProgress(percent) {
        const progress = document.getElementById('file-progress');
        const fill = document.getElementById('progress-fill');
        const text = document.getElementById('progress-text');
        
        progress.style.display = 'block';
        fill.style.width = `${percent}%`;
        text.textContent = `${Math.round(percent)}%`;
      }

      // éšè—è¿›åº¦æ¡
      function hideProgress() {
        document.getElementById('file-progress').style.display = 'none';
      }

      // è®¡ç®—æ–‡æœ¬å“ˆå¸Œ
      async function calculateTextHash() {
        const text = document.getElementById('text-input').value.trim();
        if (!text) {
          alert('è¯·è¾“å…¥æ–‡æœ¬');
          return;
        }

        const selectedAlgos = getSelectedAlgorithms();
        if (selectedAlgos.length === 0) {
          alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªå“ˆå¸Œç®—æ³•');
          return;
        }

        showLoading('text');
        
        try {
          const results = [];
          
          for (const algo of selectedAlgos) {
            let hash;
            
            switch(algo.id) {
              case 'md5':
                hash = CryptoJS.MD5(text).toString();
                break;
              case 'sha1':
                hash = CryptoJS.SHA1(text).toString();
                break;
              case 'sha256':
                hash = CryptoJS.SHA256(text).toString();
                break;
              case 'sha512':
                hash = CryptoJS.SHA512(text).toString();
                break;
              case 'sha3-256':
                hash = sha3_256(text);
                break;
              case 'sha3-512':
                hash = sha3_512(text);
                break;
              case 'blake2b':
                // å¼‚æ­¥åŠ è½½ BLAKE2b
                const blake2bLib = await loadBlake2b();
                if (blake2bLib) {
                  const encoder = new TextEncoder();
                  const data = encoder.encode(text);
                  hash = blake2bLib(data).toString('hex');
                } else {
                  hash = 'BLAKE2b åº“åŠ è½½å¤±è´¥';
                }
                break;
              default:
                hash = 'ä¸æ”¯æŒè¯¥ç®—æ³•';
            }
            
            results.push({
              name: algo.name,
              bits: algo.bits,
              value: hash,
              length: hash.length
            });
          }
          
          displayResults(results);
        } catch (error) {
          console.error('è®¡ç®—å“ˆå¸Œæ—¶å‡ºé”™:', error);
          alert('è®¡ç®—å“ˆå¸Œæ—¶å‡ºé”™: ' + error.message);
        } finally {
          hideLoading('text');
        }
      }

      // è®¡ç®—æ–‡ä»¶å“ˆå¸Œ
      async function calculateFileHash() {
        if (!selectedFile) {
          alert('è¯·é€‰æ‹©æ–‡ä»¶');
          return;
        }

        const selectedAlgos = getSelectedAlgorithms();
        if (selectedAlgos.length === 0) {
          alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªå“ˆå¸Œç®—æ³•');
          return;
        }

        showLoading('file');
        showProgress(0);

        try {
          const results = [];
          const file = selectedFile;
          
          // è¯»å–æ–‡ä»¶ä¸º ArrayBuffer
          const arrayBuffer = await readFileAsArrayBuffer(file);
          
          // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
          showFileInfo(file);
          
          // è®¡ç®—æ¯ä¸ªé€‰ä¸­çš„å“ˆå¸Œç®—æ³•
          for (let i = 0; i < selectedAlgos.length; i++) {
            const algo = selectedAlgos[i];
            let hash;
            
            try {
              // å°† ArrayBuffer è½¬æ¢ä¸º CryptoJS å¯ç”¨çš„æ ¼å¼
              const wordArray = CryptoJS.lib.WordArray.create(arrayBuffer);
              
              switch(algo.id) {
                case 'md5':
                  hash = CryptoJS.MD5(wordArray).toString();
                  break;
                case 'sha1':
                  hash = CryptoJS.SHA1(wordArray).toString();
                  break;
                case 'sha256':
                  hash = CryptoJS.SHA256(wordArray).toString();
                  break;
                case 'sha512':
                  hash = CryptoJS.SHA512(wordArray).toString();
                  break;
                case 'sha3-256':
                  // å°† ArrayBuffer è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²
                  const hexString256 = arrayBufferToHex(arrayBuffer);
                  hash = sha3_256(hexString256);
                  break;
                case 'sha3-512':
                  const hexString512 = arrayBufferToHex(arrayBuffer);
                  hash = sha3_512(hexString512);
                  break;
                case 'blake2b':
                  // å¼‚æ­¥åŠ è½½ BLAKE2b
                  const blake2bLib = await loadBlake2b();
                  if (blake2bLib) {
                    hash = blake2bLib(new Uint8Array(arrayBuffer)).toString('hex');
                  } else {
                    hash = 'BLAKE2b åº“åŠ è½½å¤±è´¥';
                  }
                  break;
                default:
                  hash = 'ä¸æ”¯æŒè¯¥ç®—æ³•';
              }
              
              results.push({
                name: algo.name,
                bits: algo.bits,
                value: hash,
                length: hash.length
              });
              
              // æ›´æ–°è¿›åº¦
              showProgress(((i + 1) / selectedAlgos.length) * 100);
              
            } catch (error) {
              console.error(`è®¡ç®— ${algo.name} å“ˆå¸Œæ—¶å‡ºé”™:`, error);
              results.push({
                name: algo.name,
                bits: algo.bits,
                value: `é”™è¯¯: ${error.message}`,
                length: 0
              });
            }
          }
          
          displayResults(results);
          hideLoading('file');
          hideProgress();
          
        } catch (error) {
          console.error('å¤„ç†æ–‡ä»¶æ—¶å‡ºé”™:', error);
          alert('å¤„ç†æ–‡ä»¶æ—¶å‡ºé”™: ' + error.message);
          hideLoading('file');
          hideProgress();
        }
      }

      // è¯»å–æ–‡ä»¶ä¸º ArrayBuffer
      function readFileAsArrayBuffer(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          
          reader.onload = function(e) {
            resolve(e.target.result);
          };
          
          reader.onerror = function(e) {
            reject(new Error('è¯»å–æ–‡ä»¶å¤±è´¥'));
          };
          
          reader.readAsArrayBuffer(file);
        });
      }

      // ArrayBuffer è½¬åå…­è¿›åˆ¶å­—ç¬¦ä¸²
      function arrayBufferToHex(buffer) {
        const byteArray = new Uint8Array(buffer);
        const hexParts = [];
        for (let i = 0; i < byteArray.length; i++) {
          const hex = byteArray[i].toString(16).padStart(2, '0');
          hexParts.push(hex);
        }
        return hexParts.join('');
      }

      // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
      function showFileInfo(file) {
        const fileInfo = document.getElementById('file-info');
        fileInfo.style.display = 'block';
        fileInfo.innerHTML = `
          <div class="file-info-title">æ–‡ä»¶ä¿¡æ¯</div>
          <div class="file-details">
            <div class="file-detail">
              <span class="detail-label">æ–‡ä»¶å:</span>
              <span class="detail-value">${file.name}</span>
            </div>
            <div class="file-detail">
              <span class="detail-label">æ–‡ä»¶å¤§å°:</span>
              <span class="detail-value">${formatFileSize(file.size)}</span>
            </div>
            <div class="file-detail">
              <span class="detail-label">ä¿®æ”¹æ—¶é—´:</span>
              <span class="detail-value">${new Date(file.lastModified).toLocaleString()}</span>
            </div>
            <div class="file-detail">
              <span class="detail-label">æ–‡ä»¶ç±»å‹:</span>
              <span class="detail-value">${file.type || 'æœªçŸ¥'}</span>
            </div>
          </div>
        `;
      }

      // æ˜¾ç¤ºç»“æœ
      function displayResults(results) {
        const resultsSection = document.getElementById('results-section');
        const hashResults = document.getElementById('hash-results');
        
        resultsSection.style.display = 'block';
        hashResults.innerHTML = '';
        
        results.forEach(result => {
          const hashItem = document.createElement('div');
          hashItem.className = 'hash-item';
          hashItem.innerHTML = `
            <div class="hash-header">
              <div class="hash-name">
                <span>${result.name}</span>
                <span class="hash-bits">${result.bits}</span>
              </div>
              <span class="hash-length">${result.length} å­—ç¬¦</span>
            </div>
            <div class="hash-value">${result.value}</div>
            <div class="hash-actions">
              <button class="copy-btn" data-hash="${result.value}">å¤åˆ¶</button>
            </div>
          `;
          
          hashResults.appendChild(hashItem);
        });
        
        // ä¸ºæ¯ä¸ªå¤åˆ¶æŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
        document.querySelectorAll('.copy-btn').forEach(btn => {
          btn.addEventListener('click', function(e) {
            const hash = this.getAttribute('data-hash');
            copyToClipboard(hash, this);
          });
        });
        
        // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
        resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }

      // å¤åˆ¶åˆ°å‰ªè´´æ¿
      async function copyToClipboard(text, button) {
        try {
          await navigator.clipboard.writeText(text);
          // æ˜¾ç¤ºå¤åˆ¶æˆåŠŸåé¦ˆ
          button.textContent = 'å·²å¤åˆ¶';
          button.classList.add('copied');
          setTimeout(() => {
            button.textContent = 'å¤åˆ¶';
            button.classList.remove('copied');
          }, 2000);
        } catch (err) {
          console.error('å¤åˆ¶å¤±è´¥:', err);
          // å¤‡ç”¨æ–¹æ³•
          const textArea = document.createElement('textarea');
          textArea.value = text;
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand('copy');
          document.body.removeChild(textArea);
          
          // æ˜¾ç¤ºå¤åˆ¶æˆåŠŸåé¦ˆ
          button.textContent = 'å·²å¤åˆ¶';
          button.classList.add('copied');
          setTimeout(() => {
            button.textContent = 'å¤åˆ¶';
            button.classList.remove('copied');
          }, 2000);
        }
      }

      // å¤åˆ¶æ‰€æœ‰å“ˆå¸Œå€¼
      function copyAllHashes() {
        const hashValues = Array.from(document.querySelectorAll('.hash-value'))
          .map(el => {
            const algoName = el.closest('.hash-item').querySelector('.hash-name span').textContent;
            const hashValue = el.textContent;
            return `${algoName}: ${hashValue}`;
          })
          .join('\n');
        
        const btn = document.getElementById('copy-all-btn');
        const originalText = btn.textContent;
        
        // åˆ›å»ºä¸´æ—¶æ–‡æœ¬åŒºåŸŸè¿›è¡Œå¤åˆ¶
        const textArea = document.createElement('textarea');
        textArea.value = hashValues;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        
        // æ˜¾ç¤ºåé¦ˆ
        btn.textContent = 'å·²å¤åˆ¶å…¨éƒ¨';
        setTimeout(() => {
          btn.textContent = originalText;
        }, 2000);
      }

      // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
      function formatFileSize(bytes) {
        if (bytes === 0) return '0 B';
        const k = 1024;
        const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
      }

      // åˆå§‹åŒ–é¡µé¢
      document.addEventListener('DOMContentLoaded', function() {
        // åˆå§‹åŒ–ç®—æ³•é€‰æ‹©å™¨
        initAlgorithmSelector();
        
        // æ–‡æœ¬è®¡ç®—æŒ‰é’®äº‹ä»¶
        document.getElementById('calculate-text-btn').addEventListener('click', calculateTextHash);
        
        // æ¸…ç©ºæ–‡æœ¬æŒ‰é’®äº‹ä»¶
        document.getElementById('clear-text-btn').addEventListener('click', function() {
          document.getElementById('text-input').value = '';
        });
        
        // ç¤ºä¾‹æ–‡æœ¬æŒ‰é’®äº‹ä»¶
        document.getElementById('example-text-btn').addEventListener('click', function() {
          document.getElementById('text-input').value = 'Hello, World! è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ–‡æœ¬ï¼Œç”¨äºè®¡ç®—å“ˆå¸Œå€¼ã€‚\n' +
            'MD5 å“ˆå¸Œé€šå¸¸ç”¨äºæ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒã€‚\n' +
            'SHA-256 æ˜¯æ¯”ç‰¹å¸å’Œè®¸å¤šåŒºå—é“¾ç³»ç»Ÿä½¿ç”¨çš„å“ˆå¸Œç®—æ³•ã€‚';
        });
        
        // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
        document.getElementById('file-input').addEventListener('change', function(e) {
          const file = e.target.files[0];
          if (file) {
            selectedFile = file;
            document.getElementById('file-name').textContent = `${file.name} (${formatFileSize(file.size)})`;
            document.getElementById('calculate-file-btn').disabled = false;
            document.getElementById('file-info').style.display = 'none';
          } else {
            selectedFile = null;
            document.getElementById('file-name').textContent = 'æœªé€‰æ‹©æ–‡ä»¶';
            document.getElementById('calculate-file-btn').disabled = true;
          }
        });
        
        // æ–‡ä»¶è®¡ç®—æŒ‰é’®äº‹ä»¶
        document.getElementById('calculate-file-btn').addEventListener('click', calculateFileHash);
        
        // æ¸…é™¤æ–‡ä»¶æŒ‰é’®äº‹ä»¶
        document.getElementById('clear-file-btn').addEventListener('click', function() {
          document.getElementById('file-input').value = '';
          selectedFile = null;
          document.getElementById('file-name').textContent = 'æœªé€‰æ‹©æ–‡ä»¶';
          document.getElementById('calculate-file-btn').disabled = true;
          document.getElementById('file-info').style.display = 'none';
        });
        
        // å¤åˆ¶æ‰€æœ‰æŒ‰é’®äº‹ä»¶
        document.getElementById('copy-all-btn').addEventListener('click', copyAllHashes);
        
        // æ–‡æœ¬è¾“å…¥æ¡† Ctrl+Enter è®¡ç®—
        document.getElementById('text-input').addEventListener('keydown', function(e) {
          if (e.ctrlKey && e.key === 'Enter') {
            calculateTextHash();
          }
        });

        // é¢„åŠ è½½ BLAKE2b åº“
        loadBlake2b();
      });
    </script>
  </body>
</html>
